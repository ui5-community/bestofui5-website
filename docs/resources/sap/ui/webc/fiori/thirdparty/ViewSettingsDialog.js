sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/decorators/property","sap/ui/webc/common/thirdparty/base/decorators/slot","sap/ui/webc/common/thirdparty/base/decorators/customElement","sap/ui/webc/common/thirdparty/base/decorators/event","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/main/thirdparty/Dialog","sap/ui/webc/main/thirdparty/Button","sap/ui/webc/main/thirdparty/Label","sap/ui/webc/main/thirdparty/GroupHeaderListItem","sap/ui/webc/main/thirdparty/List","sap/ui/webc/main/thirdparty/StandardListItem","sap/ui/webc/main/thirdparty/Title","sap/ui/webc/main/thirdparty/SegmentedButton","sap/ui/webc/main/thirdparty/SegmentedButtonItem","./Bar","./types/ViewSettingsDialogMode","sap/ui/webc/common/thirdparty/icons/sort","sap/ui/webc/common/thirdparty/icons/filter","sap/ui/webc/common/thirdparty/icons/nav-back","./generated/i18n/i18n-defaults","./generated/templates/ViewSettingsDialogTemplate.lit","./generated/themes/ViewSettingsDialog.css"],function(t,e,i,r,s,n,o,l,d,a,c,u,f,h,g,_,p,S,y,m,O,B,b,T,x,w){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;e=I(e);i=I(i);r=I(r);s=I(s);l=I(l);d=I(d);a=I(a);c=I(c);u=I(u);f=I(f);h=I(h);g=I(g);_=I(_);p=I(p);S=I(S);y=I(y);m=I(m);x=I(x);w=I(w);function I(t){return t&&t.__esModule?t:{default:t}}var D=void 0&&(void 0).__decorate||function(t,e,i,r){var s=arguments.length,n=s<3?e:r===null?r=Object.getOwnPropertyDescriptor(e,i):r,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(t,e,i,r);else for(var l=t.length-1;l>=0;l--)if(o=t[l])n=(s<3?o(n):s>3?o(e,i,n):o(e,i))||n;return s>3&&n&&Object.defineProperty(e,i,n),n};var v;let E=v=class t extends d.default{constructor(){super();this._currentSettings={sortOrder:[],sortBy:[],filters:[]}}onBeforeRendering(){if(this._currentSettings.filters&&this._currentSettings.filters.length){this._setAdditionalTexts()}if(!this.shouldBuildSort&&this.shouldBuildFilter){this._currentMode=m.default.Filter}}_setAdditionalTexts(){this.filterItems.forEach((t,e)=>{let i=0;for(let r=0;r<t.values.length;r++){if(this._currentSettings.filters[e].filterOptions[r].selected){i++}}t.additionalText=!i?"":`${i}`})}static async onDefine(){v.i18nBundle=await(0,n.getI18nBundle)("@ui5/webcomponents-fiori")}get _selectedFilter(){for(let t=0;t<this._currentSettings.filters.length;t++){if(this._currentSettings.filters[t].selected){return this._currentSettings.filters[t]}}}get shouldBuildSort(){return!!this.sortItems.length}get shouldBuildFilter(){return!!this.filterItems.length}get hasPagination(){return this.shouldBuildSort&&this.shouldBuildFilter}get _filterByTitle(){const t=this._selectedFilter?this._selectedFilter.text:"";return`${v.i18nBundle.getText(T.VSD_FILTER_BY)}: ${t}`}get _dialogTitle(){return v.i18nBundle.getText(T.VSD_DIALOG_TITLE_SORT)}get _okButtonLabel(){return v.i18nBundle.getText(T.VSD_SUBMIT_BUTTON)}get _cancelButtonLabel(){return v.i18nBundle.getText(T.VSD_CANCEL_BUTTON)}get _resetButtonLabel(){return v.i18nBundle.getText(T.VSD_RESET_BUTTON)}get _ascendingLabel(){return v.i18nBundle.getText(T.VSD_ORDER_ASCENDING)}get _descendingLabel(){return v.i18nBundle.getText(T.VSD_ORDER_DESCENDING)}get _sortOrderLabel(){return v.i18nBundle.getText(T.VSD_SORT_ORDER)}get _filterByLabel(){return v.i18nBundle.getText(T.VSD_FILTER_BY)}get _sortByLabel(){return v.i18nBundle.getText(T.VSD_SORT_BY)}get _isPhone(){return(0,o.isPhone)()}get _sortAscending(){return!this.sortDescending}get _title(){return this.showBackButton?this._filterByTitle:this._dialogTitle}get _disableResetButton(){return this._dialog&&this._sortSetttingsAreInitial&&this._filteresAreInitial}get _sortSetttingsAreInitial(){let t=true;["sortBy","sortOrder"].forEach(e=>{this._currentSettings[e].forEach((i,r)=>{if(i.selected!==this._initialSettings[e][r].selected){t=false}})});return t}get _filteresAreInitial(){let t=true;this._currentSettings.filters.forEach((e,i)=>{for(let r=0;r<e.filterOptions.length;r++){if(e.filterOptions[r].selected!==this._initialSettings.filters[i].filterOptions[r].selected){t=false}}});return t}get _settings(){return{sortOrder:JSON.parse(JSON.stringify(this.initSortOrderItems)),sortBy:JSON.parse(JSON.stringify(this.initSortByItems)),filters:this.filterItems.map(t=>({text:t.text,selected:false,filterOptions:t.values.map(t=>({text:t.text,selected:t.selected}))}))}}get initSortByItems(){return this.sortItems.map((t,e)=>({text:t.text,selected:t.selected,index:e}))}get initSortOrderItems(){return[{text:this._ascendingLabel,selected:!this.sortDescending},{text:this._descendingLabel,selected:this.sortDescending}]}get expandContent(){return this._filterStepTwo||!this.hasPagination}get isModeSort(){return this._currentMode===m.default.Sort}get isModeFilter(){return this._currentMode===m.default.Filter}get showBackButton(){return this.isModeFilter&&this._filterStepTwo}get _sortOrderListDomRef(){return this.shadowRoot.querySelector("[ui5-list][sort-order]")}get _sortByList(){return this.shadowRoot.querySelector("[ui5-list][sort-by]")}get _dialogDomRef(){return this.shadowRoot.querySelector("[ui5-dialog]")}show(){if(!this._dialog){this._sortOrder=this._sortOrderListDomRef;this._sortBy=this._sortByList;this._initialSettings=this._settings;this._currentSettings=this._settings;this._confirmedSettings=this._settings;this._dialog=this._dialogDomRef}else{this._restoreSettings(this._confirmedSettings)}this.fireEvent("before-open",{},true,false);this._dialog.show(true);this._dialog.querySelector("[ui5-list]")?.focusFirstItem()}_handleModeChange(t){const e=t.detail.selectedItem.getAttribute("mode");this._currentMode=m.default[e]}_handleFilterValueItemClick(t){this._currentSettings.filters=this._currentSettings.filters.map(e=>{if(e.selected){e.filterOptions.forEach(e=>{if(e.text===t.detail.item.innerText){e.selected=!e.selected}})}return e});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}_navigateToFilters(){this._filterStepTwo=false}_changeCurrentFilter(t){this._filterStepTwo=true;this._currentSettings.filters=this._currentSettings.filters.map(e=>{e.selected=e.text===t.detail.item.innerText;return e})}close(){this._dialog&&this._dialog.close()}_focusRecentlyUsedControl(){if(!this._recentlyFocused||!Object.keys(this._recentlyFocused).length){return}const t=this._recentlyFocused.getSelectedItems();if(t.length){t[0].focus()}}_confirmSettings(){this.close();this._confirmedSettings=this._currentSettings;this.fireEvent("confirm",this.eventsParams)}_cancelSettings(){this._restoreSettings(this._confirmedSettings);this.fireEvent("cancel",this.eventsParams);this.close()}get eventsParams(){const t=this._currentSettings.sortOrder.filter(t=>t.selected)[0],e=this._currentSettings.sortBy.filter(t=>t.selected)[0],i=t&&t.text,r=!this._currentSettings.sortOrder[0].selected,s=e&&e.text,n=e&&e.index,o=this.sortItems[n];return{sortOrder:i,sortDescending:r,sortBy:s,sortByItem:o,filters:this.selectedFilters}}get selectedFilters(){const t=[];this._currentSettings.filters.forEach(e=>{const i=[];e.filterOptions.forEach(t=>{if(t.selected){i.push(t.text)}});if(i.length){t.push({});t[t.length-1][e.text]=i}});return t}_restoreConfirmedOnEscape(t){if(t.detail.escPressed){this._cancelSettings();this._currentMode=m.default.Sort;this._filterStepTwo=false}}_resetSettings(){this._restoreSettings(this._initialSettings);this._recentlyFocused=this._sortOrder;this._focusRecentlyUsedControl()}_restoreSettings(t){this._currentSettings=JSON.parse(JSON.stringify(t));this._currentMode=m.default.Sort;this._filterStepTwo=false}_onSortOrderChange(t){this._recentlyFocused=this._sortOrder;this._currentSettings.sortOrder=this.initSortOrderItems.map(e=>{e.selected=e.text===t.detail.item.innerText;return e});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}_onSortByChange(t){const e=Number(t.detail.item.getAttribute("data-ui5-external-action-item-index"));this._recentlyFocused=this._sortBy;this._currentSettings.sortBy=this.initSortByItems.map((t,i)=>{t.selected=i===e;return t});this._currentSettings=JSON.parse(JSON.stringify(this._currentSettings))}setConfirmedSettings(t){if(t&&this._dialog&&!this._dialog.isOpen()){const e=JSON.parse(JSON.stringify(this._confirmedSettings));if(t.sortOrder){for(let i=0;i<e.sortOrder.length;i++){if(e.sortOrder[i].text===t.sortOrder){e.sortOrder[i].selected=true}else{e.sortOrder[i].selected=false}}}if(t.sortBy){for(let i=0;i<e.sortBy.length;i++){if(e.sortBy[i].text===t.sortBy){e.sortBy[i].selected=true}else{e.sortBy[i].selected=false}}}if(t.filters){const i={};for(let e=0;e<t.filters.length;e++){i[Object.keys(t.filters[e])[0]]=t.filters[e][Object.keys(t.filters[e])[0]]}for(let t=0;t<e.filters.length;t++){for(let r=0;r<e.filters[t].filterOptions.length;r++){if(i[e.filters[t].text]&&i[e.filters[t].text].indexOf(e.filters[t].filterOptions[r].text)>-1){e.filters[t].filterOptions[r].selected=true}else{e.filters[t].filterOptions[r].selected=false}}}}this._confirmedSettings=JSON.parse(JSON.stringify(e))}}};D([(0,e.default)({type:Boolean})],E.prototype,"sortDescending",void 0);D([(0,e.default)({type:Object})],E.prototype,"_recentlyFocused",void 0);D([(0,e.default)({type:Object})],E.prototype,"_initialSettings",void 0);D([(0,e.default)({type:Object})],E.prototype,"_confirmedSettings",void 0);D([(0,e.default)({type:Object})],E.prototype,"_currentSettings",void 0);D([(0,e.default)({type:m.default,defaultValue:m.default.Sort})],E.prototype,"_currentMode",void 0);D([(0,e.default)({type:Boolean,noAttribute:true})],E.prototype,"_filterStepTwo",void 0);D([(0,i.default)()],E.prototype,"sortItems",void 0);D([(0,i.default)()],E.prototype,"filterItems",void 0);E=v=D([(0,r.default)({tag:"ui5-view-settings-dialog",renderer:l.default,styles:w.default,template:x.default,dependencies:[y.default,c.default,_.default,a.default,u.default,h.default,g.default,f.default,p.default,S.default]}),(0,s.default)("confirm",{detail:{sortOrder:{type:String},sortBy:{type:String},sortByItem:{type:HTMLElement},sortDescending:{type:Boolean},filters:{type:Array}}}),(0,s.default)("cancel",{detail:{sortOrder:{type:String},sortBy:{type:String},sortByItem:{type:HTMLElement},sortDescending:{type:Boolean},filters:{type:Array}}}),(0,s.default)("before-open")],E);E.define();var R=E;t.default=R});
//# sourceMappingURL=ViewSettingsDialog.js.map