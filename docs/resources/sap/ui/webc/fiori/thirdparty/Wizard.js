sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/decorators/property","sap/ui/webc/common/thirdparty/base/decorators/slot","sap/ui/webc/common/thirdparty/base/decorators/event","sap/ui/webc/common/thirdparty/base/decorators/customElement","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/types/NavigationMode","sap/ui/webc/common/thirdparty/base/types/Float","sap/ui/webc/common/thirdparty/base/util/clamp","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/util/debounce","sap/ui/webc/common/thirdparty/base/util/FocusableElements","sap/ui/webc/main/thirdparty/Button","sap/ui/webc/main/thirdparty/ResponsivePopover","sap/ui/webc/main/thirdparty/generated/themes/BrowserScrollbar.css","./types/WizardContentLayout","./generated/i18n/i18n-defaults","./WizardTab","./WizardStep","./generated/templates/WizardTemplate.lit","./generated/templates/WizardPopoverTemplate.lit","./generated/themes/Wizard.css","./generated/themes/WizardPopover.css"],function(e,t,s,i,r,n,o,l,a,d,c,p,u,h,f,S,g,b,A,I,y,_,v,m,T,w,x){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;t=R(t);s=R(s);i=R(i);r=R(r);n=R(n);o=R(o);a=R(a);d=R(d);c=R(c);p=R(p);u=R(u);f=R(f);g=R(g);b=R(b);A=R(A);I=R(I);_=R(_);v=R(v);m=R(m);T=R(T);w=R(w);x=R(x);function R(e){return e&&e.__esModule?e:{default:e}}var O=void 0&&(void 0).__decorate||function(e,t,s,i){var r=arguments.length,n=r<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)if(o=e[l])n=(r<3?o(n):r>3?o(t,s,n):o(t,s))||n;return r>3&&n&&Object.defineProperty(t,s,n),n};var B;const C=64;const E=200;const D="data-ui5-wizard-expanded-tab";const L="data-ui5-wizard-expanded-tab-next";const H="data-ui5-wizard-after-current-tab";const M="data-ui5-wizard-expanded-tab-prev";const z={MIN:.5,DEFAULT:.7,MAX:1};const P={0:"S",599:"M",1023:"L",1439:"XL"};let N=B=class e extends t.default{constructor(){super();this.stepScrollOffsets=[];this._groupedTabs=[];this.selectedStepIndex=0;this.previouslySelectedStepIndex=0;this.selectionRequestedByClick=false;this._prevWidth=0;this._prevContentHeight=0;this.selectionRequestedByScroll=false;this._itemNavigation=new a.default(this,{navigationMode:d.default.Auto,getItemsCallback:()=>this.enabledStepsInHeaderDOM});this._onStepResize=this.onStepResize.bind(this)}get classes(){return{popover:{"ui5-wizard-responsive-popover":true,"ui5-wizard-popover":!(0,h.isPhone)(),"ui5-wizard-dialog":(0,h.isPhone)()}}}static async onDefine(){B.i18nBundle=await(0,l.getI18nBundle)("@ui5/webcomponents-fiori")}static get SCROLL_DEBOUNCE_RATE(){return 25}onExitDOM(){this.detachStepsResizeObserver()}onBeforeRendering(){this.syncSelection()}onAfterRendering(){this.storeStepScrollOffsets();if(this.previouslySelectedStepIndex!==this.selectedStepIndex){this.scrollToSelectedStep()}this.attachStepsResizeObserver();this.previouslySelectedStepIndex=this.selectedStepIndex}syncSelection(){if(this.stepsCount===0){return}if(this.selectedStepsCount===0){this.selectFirstStep();console.warn("Selecting the first step: no selected step is defined.")}if(this.selectedStepsCount>1){this.selectLastSelectedStep();console.warn(`Selecting the last step defined as selected: multiple selected steps are defined.`)}if(this.selectedStep&&this.selectedStep.disabled){console.warn("The selected step is disabled: you need to enable it in order to interact with the step.")}this.selectedStepIndex=this.getSelectedStepIndex()}selectFirstStep(){this.deselectAll();this.slottedSteps[0].selected=true;this.slottedSteps[0].disabled=false}selectLastSelectedStep(){const e=this.lastSelectedStep;if(e){this.deselectAll();e.selected=true;e.disabled=false}}deselectAll(){this.slottedSteps.forEach(e=>{e.selected=false})}storeStepScrollOffsets(){this.stepScrollOffsets=this.slottedSteps.map(e=>{const t=this.getStepWrapperByRefId(e._id);return t.offsetTop+t.offsetHeight})}onSelectionChangeRequested(e){this.selectionRequestedByClick=true;this.changeSelectionByStepAction(e.target)}onScroll(e){if(this.selectionRequestedByClick){this.selectionRequestedByClick=false;return}(0,f.default)(this.changeSelectionByScroll.bind(this,e.target.scrollTop),B.SCROLL_DEBOUNCE_RATE)}onStepInHeaderFocused(e){this._itemNavigation.setCurrentItem(e.target)}onStepResize(){this.width=this.getBoundingClientRect().width;this.contentHeight=this.getContentHeight();if(this._prevWidth!==this.width||this.contentHeight!==this._prevContentHeight){this._closeRespPopover()}this._prevWidth=this.width;this._prevContentHeight=this.contentHeight;this._calcCurrentBreakpoint()}attachStepsResizeObserver(){this.stepsDOM.forEach(e=>{u.default.deregister(e,this._onStepResize);u.default.register(e,this._onStepResize)})}detachStepsResizeObserver(){this.stepsDOM.forEach(e=>{u.default.deregister(e,this._onStepResize)})}_calcCurrentBreakpoint(){const e=Object.keys(P).reverse();const t=e.find(e=>Number(e)<this.width);this._breakpoint=t?P[t]:P["0"]}_adjustHeaderOverflow(){let e=0;let t=true;const s=this.stepsInHeaderDOM;if(!s.length){return}const i=this.progressNavigatorListDOM.getBoundingClientRect().width;const r=this.getSelectedStepIndex();const n=this.steps.length?Math.floor(i/E):Math.floor(i/C);[...s].forEach((e,t)=>{e.setAttribute(D,"false");e.setAttribute(M,"false");e.setAttribute(L,"false");if(t>r){s[t].setAttribute(H,"true")}else{s[t].removeAttribute(H)}});if(s[r]){s[r].setAttribute(D,"true")}for(let i=1;i<n;i++){if(t){e+=1}if(t&&s[r+e]){s[r+e].setAttribute(D,"true");t=!t}else if(!t&&s[r-e]){s[r-e].setAttribute(D,"true");t=!t}else if(s[r+e+1]){e+=1;s[r+e].setAttribute(D,"true");t=true}else if(s[r-e]){s[r-e].setAttribute(D,"true");e+=1;t=false}}for(let e=0;e<s.length;e++){if(s[e].getAttribute(D)==="true"&&s[e-1]&&s[e-1].getAttribute(D)==="false"){s[e-1].setAttribute(M,"true")}if(s[e].getAttribute(D)==="false"&&s[e-1]&&s[e-1].getAttribute(D)==="true"){s[e].setAttribute(L,"true");break}}}_isGroupAtStart(e){const t=this.stepsInHeaderDOM.indexOf(e);return e.getAttribute(D)==="false"&&e.getAttribute(M)==="true"&&t>0}_isGroupAtEnd(e){const t=this.stepsInHeaderDOM.indexOf(e);return e.getAttribute(D)==="false"&&e.getAttribute(L)==="true"&&t+1<this.steps.length}async _showPopover(e,t){const s=Array.from(this.stepsInHeaderDOM);this._groupedTabs=[];const i=t?0:this.stepsInHeaderDOM.indexOf(e);const r=t?this.stepsInHeaderDOM.indexOf(e):s.length-1;for(let e=i;e<=r;e++){this._groupedTabs.push(s[e])}const n=await this._respPopover();n.showAt(e)}async _onGroupedTabClick(e){const t=e.target;if(this._isGroupAtStart(t)){return this._showPopover(t,true)}if(this._isGroupAtEnd(t)){return this._showPopover(t,false)}}_onOverflowStepButtonClick(e){const t=Array.from(this.stepsInHeaderDOM);const s=e.target;const i=s.getAttribute("data-ui5-header-tab-ref-id");const r=this.slottedSteps[Number(i)-1];const n=this.selectedStep;const o=this.slottedSteps.indexOf(r);this.switchSelectionFromOldToNewStep(n,r,o,true);this._closeRespPopover();t[o].focus()}async _closeRespPopover(){const e=await this._respPopover();e&&e.close()}async _respPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector(`.ui5-wizard-responsive-popover`)}changeSelectionByScroll(e){const t=this.getClosestStepIndexByScrollPos(e);const s=this.slottedSteps[t];if(this.selectedStepIndex===t){return}if(!s.disabled&&t>=0&&t<=this.stepsCount-1){this.switchSelectionFromOldToNewStep(this.selectedStep,s,t,false);this.selectionRequestedByScroll=true}}async changeSelectionByStepAction(e){const t=e.getAttribute("data-ui5-content-ref-id");const s=this.selectedStep;const i=this.getStepByRefId(t);const r=e.getAttribute(D)==="true";const n=this.slottedSteps.indexOf(i);const o=i.firstElementChild;const l=await(0,S.getFirstFocusableElement)(o);if(l){l.focus()}if(s===i){this.scrollToContentItem(this.selectedStepIndex);return}if(r||!r&&(n===0||n===this.steps.length-1)){this.switchSelectionFromOldToNewStep(s,i,n,true)}}getContentHeight(){let e=0;this.stepsDOM.forEach(t=>{e+=t.getBoundingClientRect().height});return e}getStepAriaLabelText(e,t){return B.i18nBundle.getText(y.WIZARD_STEP_ARIA_LABEL,t)}get stepsDOM(){return Array.from(this.shadowRoot.querySelectorAll(".ui5-wiz-content-item"))}get progressNavigatorListDOM(){return this.shadowRoot.querySelector(".ui5-wiz-nav-list")}get _stepsInHeader(){return this.getStepsInfo()}get _steps(){const e=this.getLastEnabledStepIndex();const t=this.getStepsInfo();return this.steps.map((s,i)=>{s.stretch=i===e;s.stepContentAriaLabel=`${this.navStepDefaultHeading} ${t[i].number} ${t[i].titleText}`;return s})}get stepsCount(){return this.slottedSteps.length}get selectedStep(){if(this.selectedStepsCount){return this.selectedSteps[0]}return null}get lastSelectedStep(){if(this.selectedStepsCount){return this.selectedSteps[this.selectedStepsCount-1]}return null}get selectedSteps(){return this.slottedSteps.filter(e=>e.selected)}get enabledSteps(){return this.slottedSteps.filter(e=>!e.disabled)}get selectedStepsCount(){return this.selectedSteps.length}get slottedSteps(){return this.getSlottedNodes("steps")}get contentDOM(){return this.shadowRoot.querySelector(`.ui5-wiz-content`)}get stepsInHeaderDOM(){return Array.from(this.shadowRoot.querySelectorAll("[ui5-wizard-tab]"))}get enabledStepsInHeaderDOM(){return this.stepsInHeaderDOM}get navAriaRoleDescription(){return B.i18nBundle.getText(y.WIZARD_NAV_ARIA_ROLE_DESCRIPTION)}get navAriaLabelText(){return B.i18nBundle.getText(y.WIZARD_NAV_ARIA_LABEL)}get navAriaDescribedbyText(){return B.i18nBundle.getText(y.WIZARD_LIST_ARIA_DESCRIBEDBY)}get listAriaLabelText(){return B.i18nBundle.getText(y.WIZARD_LIST_ARIA_LABEL)}get actionSheetStepsText(){return B.i18nBundle.getText(y.WIZARD_ACTIONSHEET_STEPS_ARIA_LABEL)}get navStepDefaultHeading(){return B.i18nBundle.getText(y.WIZARD_NAV_STEP_DEFAULT_HEADING)}get optionalStepText(){return B.i18nBundle.getText(y.WIZARD_OPTIONAL_STEP_ARIA_LABEL)}get activeStepText(){return B.i18nBundle.getText(y.WIZARD_STEP_ACTIVE)}get inactiveStepText(){return B.i18nBundle.getText(y.WIZARD_STEP_INACTIVE)}get ariaLabelText(){return B.i18nBundle.getText(y.WIZARD_NAV_ARIA_ROLE_DESCRIPTION)}get effectiveStepSwitchThreshold(){return(0,p.default)(this.stepSwitchThreshold,z.MIN,z.MAX)}getStepsInfo(){const e=this.getLastEnabledStepIndex();const t=this.stepsCount;const s=this.getSelectedStepIndex();let i=this.steps.length+10;let r;this._adjustHeaderOverflow();return this.steps.map((n,o)=>{const l=o+1;const a=o===t-1&&!n.branching;const d=n.subtitleText?this.optionalStepText:"";const c=n.disabled?this.inactiveStepText:this.activeStepText;const p=(n.titleText?`${l} ${n.titleText} ${c} ${d}`:`${this.navStepDefaultHeading} ${l} ${c} ${d}`).trim();const u=o>s;r={ariaSetsize:t,ariaPosinset:l,ariaLabel:this.getStepAriaLabelText(n,p)};const h={icon:n.icon,titleText:n.titleText,subtitleText:n.subtitleText,number:l,selected:n.selected,disabled:n.disabled,hideSeparator:a,activeSeparator:o<e&&!n.disabled,branchingSeparator:n.branching,pos:l,accInfo:r,refStepId:n._id,tabIndex:this.selectedStepIndex===o?"0":"-1",styles:{zIndex:u?--i:1}};return h})}getSelectedStepIndex(){if(this.selectedStep){return this.slottedSteps.indexOf(this.selectedStep)}return 0}getLastEnabledStepIndex(){let e=0;this.slottedSteps.forEach((t,s)=>{if(!t.disabled){e=s}});return e}getStepByRefId(e){return this.slottedSteps.find(t=>t._id===e)}getStepWrapperByRefId(e){return this.shadowRoot.querySelector(`[data-ui5-content-item-ref-id=${e}]`)}getStepWrapperByIdx(e){return this.getStepWrapperByRefId(this.steps[e]._id)}scrollToSelectedStep(){if(!this.selectionRequestedByScroll){this.scrollToContentItem(this.selectedStepIndex)}this.selectionRequestedByScroll=false}scrollToContentItem(e){this.contentDOM.scrollTop=this.getClosestScrollPosByStepIndex(e)}getClosestScrollPosByStepIndex(e){if(e===0){return 0}for(let t=e-1;t>=0;t--){if(this.stepScrollOffsets[t]>0){return this.stepScrollOffsets[t]}}return 0}getClosestStepIndexByScrollPos(e){for(let t=0;t<=this.stepScrollOffsets.length-1;t++){const s=this.stepScrollOffsets[t];const i=this.getStepWrapperByIdx(t);const r=i.offsetTop+i.offsetHeight*this.effectiveStepSwitchThreshold;if(s>0&&e<s){if(e>r){return t+1}return t}}return this.selectedStepIndex}switchSelectionFromOldToNewStep(e,t,s,i){if(e&&t){if(!t.disabled){e.selected=false;t.selected=true}this.fireEvent("step-change",{step:t,previousStep:e,changeWithClick:i});this.selectedStepIndex=s}}sortAscending(e,t){if(e<t){return-1}if(e>t){return 1}return 0}};O([(0,s.default)({type:I.default,defaultValue:I.default.MultipleSteps})],N.prototype,"contentLayout",void 0);O([(0,s.default)({validator:c.default})],N.prototype,"width",void 0);O([(0,s.default)({validator:c.default,defaultValue:z.DEFAULT})],N.prototype,"stepSwitchThreshold",void 0);O([(0,s.default)({validator:c.default})],N.prototype,"contentHeight",void 0);O([(0,s.default)({type:Object,multiple:true})],N.prototype,"_groupedTabs",void 0);O([(0,s.default)()],N.prototype,"_breakpoint",void 0);O([(0,i.default)({default:true,type:HTMLElement,individualSlots:true,invalidateOnChildChange:true})],N.prototype,"steps",void 0);N=B=O([(0,n.default)({tag:"ui5-wizard",languageAware:true,fastNavigation:true,renderer:o.default,styles:[A.default,w.default],staticAreaStyles:x.default,template:m.default,staticAreaTemplate:T.default,dependencies:[_.default,v.default,b.default,g.default]}),(0,r.default)("step-change",{detail:{step:{type:HTMLElement},previousStep:{type:HTMLElement},changeWithClick:{Boolean:Boolean}}})],N);N.define();var W=N;e.default=W});
//# sourceMappingURL=Wizard.js.map