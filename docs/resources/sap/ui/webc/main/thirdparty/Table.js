sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/decorators/customElement","sap/ui/webc/common/thirdparty/base/decorators/property","sap/ui/webc/common/thirdparty/base/decorators/event","sap/ui/webc/common/thirdparty/base/decorators/slot","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/types/NavigationMode","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/util/getNormalizedTarget","sap/ui/webc/common/thirdparty/base/util/getActiveElement","sap/ui/webc/common/thirdparty/base/util/TabbableElements","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/util/debounce","sap/ui/webc/common/thirdparty/base/util/isElementInView","./types/TableGrowingMode","./BusyIndicator","./types/TableMode","./CheckBox","./generated/i18n/i18n-defaults","./generated/templates/TableTemplate.lit","./generated/themes/Table.css"],function(e,t,s,i,o,n,r,l,a,d,u,c,h,f,m,p,g,w,b,_,v,y,E,R,S,C){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;t=I(t);s=I(s);i=I(i);o=I(o);n=I(n);r=I(r);l=I(l);a=I(a);d=I(d);u=I(u);h=I(h);f=I(f);w=I(w);b=I(b);_=I(_);v=I(v);y=I(y);E=I(E);S=I(S);C=I(C);function I(e){return e&&e.__esModule?e:{default:e}}var T=void 0&&(void 0).__decorate||function(e,t,s,i){var o=arguments.length,n=o<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i,r;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")n=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)if(r=e[l])n=(o<3?r(n):o>3?r(t,s,n):r(t,s))||n;return o>3&&n&&Object.defineProperty(t,s,n),n};var B;const H=250;const F=20;var x;(function(e){e["Row"]="tableRow";e["GroupRow"]="tableGroupRow";e["ColumnHeader"]="columnHeader";e["MoreButton"]="moreButton"})(x||(x={}));let M=B=class e extends t.default{static async onDefine(){B.i18nBundle=await(0,g.getI18nBundle)("@ui5/webcomponents")}constructor(){super();this.visibleColumns=[];this._columnHeader={id:`${this._id}-columnHeader`,_tabIndex:"0"};this._itemNavigation=new a.default(this,{navigationMode:u.default.Vertical,affectedPropertiesNames:["_columnHeader"],getItemsCallback:()=>[this._columnHeader,...this.rows],skipItemsSize:F});this._handleResize=this.popinContent.bind(this);this.fnOnRowFocused=this.onRowFocused.bind(this);this.fnHandleF7=this._handleF7.bind(this);this.tableEndObserved=false;this.lastFocusedElement=null;this._forwardingFocus=false;this._prevNestedElementIndex=0}onBeforeRendering(){const e=this.getColumnPropagationSettings();const t=JSON.stringify(e);const s=this.rows.length+1;const i=this.selectedRows;this.rows.forEach((i,o)=>{if(i._columnsInfoString!==t){i._columnsInfo=e;i._columnsInfoString=JSON.stringify(i._columnsInfo)}i._ariaPosition=B.i18nBundle.getText(R.TABLE_ROW_POSITION,o+2,s);i._busy=this.busy;i.removeEventListener("ui5-_focused",this.fnOnRowFocused);i.addEventListener("ui5-_focused",this.fnOnRowFocused);i.removeEventListener("ui5-f7-pressed",this.fnHandleF7);i.addEventListener("ui5-f7-pressed",this.fnHandleF7);i.mode=this.mode});this.visibleColumns=this.columns.filter((e,t)=>!this._hiddenColumns[t]);this._noDataDisplayed=!this.rows.length&&!this.hideNoData;this.visibleColumnsCount=this.visibleColumns.length;if(this.isMultiSelect){this.visibleColumnsCount+=1}this._allRowsSelected=i.length===this.rows.length;this._prevFocusedRow=this._prevFocusedRow||this.rows[0]}onAfterRendering(){if(this.growsOnScroll){this.observeTableEnd()}this.checkTableInViewport()}onEnterDOM(){this.growingIntersectionObserver=this.getIntersectionObserver();l.default.register(this.getDomRef(),this._handleResize);this._itemNavigation.setCurrentItem(this.rows.length?this.rows[0]:this._columnHeader)}onExitDOM(){l.default.deregister(this.getDomRef(),this._handleResize);this.growingIntersectionObserver.disconnect();this.growingIntersectionObserver=null;this.tableEndObserved=false}_onkeydown(e){if((0,c.isTabNext)(e)||(0,c.isTabPrevious)(e)){this._handleTab(e)}if((0,c.isCtrlA)(e)){e.preventDefault();this.isMultiSelect&&this._selectAll()}if((0,c.isUpAlt)(e)||(0,c.isDownAlt)(e)){this._handleArrowAlt(e)}if(((0,c.isUpShift)(e)||(0,c.isDownShift)(e))&&this.isMultiSelect){this._handleArrowNav(e)}if((0,c.isHomeCtrl)(e)){e.preventDefault();this._itemNavigation._handleHome();this._itemNavigation._applyTabIndex();this._itemNavigation._focusCurrentItem()}if((0,c.isEndCtrl)(e)){e.preventDefault();this._itemNavigation._handleEnd();this._itemNavigation._applyTabIndex();this._itemNavigation._focusCurrentItem()}if(((0,c.isHomeShift)(e)||(0,c.isEndShift)(e))&&this.isMultiSelect){this._handleHomeEndSelection(e)}}_handleTab(e){const t=(0,c.isTabNext)(e);const s=(0,h.default)(e.target);const i=this.getFocusedElementType(e.target);if(this.columnHeaderTabbables.includes(s)){if(t&&this.columnHeaderLastElement===s){return this._focusNextElement()}return}if(t&&i===x.ColumnHeader&&!this.columnHeaderTabbables.length){return this._focusNextElement()}if(i===x.Row||!i){return}switch(i){case x.GroupRow:return t?this._focusNextElement():this._focusForwardElement(false);case x.ColumnHeader:return!t&&this._focusForwardElement(false);case x.MoreButton:if(t){this._focusForwardElement(true)}else{e.preventDefault();this.currentElement?.focus()}}}_focusNextElement(){if(!this.growsWithButton){this._focusForwardElement(true)}else{this.morеBtn.focus()}}_handleArrowNav(e){const t=this.currentElement.localName==="tr";if(!t){return}const s=this.selectedRows;const i=this.currentItem;const o=this.currentItemIdx;const n=o-1;const r=o+1;const l=this.rows[n];const a=this.rows[r];const d=!!i.selected;if((0,c.isUpShift)(e)&&!l||(0,c.isDownShift)(e)&&!a){return}if((0,c.isUpShift)(e)){i.selected=i.selected&&!l.selected;l.selected=i.selected||d&&!i.selected;l.focus()}if((0,c.isDownShift)(e)){i.selected=i.selected&&!a.selected;a.selected=i.selected||d&&!i.selected;a.focus()}const u=this.selectedRows;this.fireEvent("selection-change",{selectedRows:u,previouslySelectedRows:s})}_handleHomeEndSelection(e){const t=this.currentElement.localName==="tr";if(!t){return}const s=this.rows;const i=this.selectedRows;const o=this.currentItemIdx;if((0,c.isHomeShift)(e)){s.slice(0,o+1).forEach(e=>{e.selected=true});s[0].focus()}if((0,c.isEndShift)(e)){s.slice(o).forEach(e=>{e.selected=true});s[s.length-1].focus()}const n=this.selectedRows;this.fireEvent("selection-change",{selectedRows:n,previouslySelectedRows:i})}_handleArrowAlt(e){const t=(0,c.isUpAlt)(e);const s=e.target;const i=this.getFocusedElementType(s);if(t){switch(i){case x.Row:case x.GroupRow:this._prevFocusedRow=s;return this._onColumnHeaderClick(e);case x.ColumnHeader:return this.morеBtn?this.morеBtn.focus():this._prevFocusedRow?.focus();case x.MoreButton:return this._prevFocusedRow?this._prevFocusedRow.focus():this._onColumnHeaderClick(e)}}else{switch(i){case x.Row:case x.GroupRow:this._prevFocusedRow=s;return this.morеBtn?this.morеBtn.focus():this._onColumnHeaderClick(e);case x.ColumnHeader:if(this._prevFocusedRow){this._prevFocusedRow.focus()}else if(this.morеBtn){this.morеBtn.focus()}return;case x.MoreButton:return this._onColumnHeaderClick(e)}}}getFocusedElementType(e){if(e===this.columnHeader){return x.ColumnHeader}if(e===this.morеBtn){return x.MoreButton}if(this.rows.includes(e)){const t=e.hasAttribute("ui5-table-group-row");return t?x.GroupRow:x.Row}}_handleF7(e){const t=e.detail.row;t._tabbables=(0,m.getTabbableElements)(t);const s=(0,f.default)();const i=t._tabbables[this._prevNestedElementIndex]||t._tabbables[0];const o=t._tabbables.indexOf(s);if(!t._tabbables.length){return}if(s===t.root){i.focus()}else if(o>-1){this._prevNestedElementIndex=o;t.root.focus()}}_onfocusin(e){const t=(0,h.default)(e.target);if(!this._isForwardElement(t)){this.lastFocusedElement=t;return}if(!this._forwardingFocus){if(this.lastFocusedElement){this.lastFocusedElement.focus()}else{this.currentElement.focus()}e.stopImmediatePropagation()}this._forwardingFocus=false}_onForwardBefore(e){this.lastFocusedElement=e.detail.target;this._focusForwardElement(false);e.stopImmediatePropagation()}_onForwardAfter(e){this.lastFocusedElement=e.detail.target;if(!this.growsWithButton){this._focusForwardElement(true)}else{this.morеBtn.focus()}}_focusForwardElement(e){this._forwardingFocus=true;this.shadowRoot.querySelector(`#${this._id}-${e?"after":"before"}`).focus()}_isForwardElement(e){const t=e.id;const s=this._getForwardElement(true);const i=this._getForwardElement(false);if(this._id===t||i&&i.id===t){return true}return!!(s&&s.id===t)}_getForwardElement(e){if(e){return this._getAfterForwardElement()}return this._getBeforeForwardElement()}_getAfterForwardElement(){if(!this._afterElement){this._afterElement=this.shadowRoot.querySelector(`#${this._id}-after`)}return this._afterElement}_getBeforeForwardElement(){if(!this._beforeElement){this._beforeElement=this.shadowRoot.querySelector(`#${this._id}-before`)}return this._beforeElement}onRowFocused(e){this._itemNavigation.setCurrentItem(e.target)}_onColumnHeaderFocused(){this._itemNavigation.setCurrentItem(this._columnHeader)}_onColumnHeaderClick(e){if(!e.target){this.columnHeader.focus()}const t=(0,h.default)(e.target);const s=this.columnHeaderTabbables.includes(t);if(!s){this.columnHeader.focus()}}_onColumnHeaderKeydown(e){if((0,c.isSpace)(e)){e.preventDefault();this.isMultiSelect&&this._selectAll()}}_onLoadMoreKeydown(e){if((0,c.isSpace)(e)){e.preventDefault();this._loadMoreActive=true}if((0,c.isEnter)(e)){this._onLoadMoreClick();this._loadMoreActive=true}}_onLoadMoreKeyup(e){if((0,c.isSpace)(e)){this._onLoadMoreClick()}this._loadMoreActive=false}_onLoadMoreClick(){this.fireEvent("load-more")}observeTableEnd(){if(!this.tableEndObserved){this.getIntersectionObserver().observe(this.tableEndDOM);this.tableEndObserved=true}}onInteresection(e){if(e.some(e=>e.isIntersecting)){(0,w.default)(this.loadMore.bind(this),H)}}loadMore(){this.fireEvent("load-more")}_handleSingleSelect(e){const t=this.getRowParent(e.target);if(!t){return}if(!t.selected){const e=this.selectedRows;this.rows.forEach(e=>{if(e.selected){e.selected=false}});t.selected=true;this.fireEvent("selection-change",{selectedRows:[t],previouslySelectedRows:e})}}_handleMultiSelect(e){const t=this.getRowParent(e.target);const s=this.selectedRows;if(!t){return}t.selected=!t.selected;const i=this.selectedRows;if(i.length===this.rows.length){this._allRowsSelected=true}else{this._allRowsSelected=false}this.fireEvent("selection-change",{selectedRows:i,previouslySelectedRows:s})}_handleSelect(e){if(this.isSingleSelect){this._handleSingleSelect(e);return}if(this.isMultiSelect){this._handleMultiSelect(e)}}_selectAll(){const e=!this._allRowsSelected;const t=this.rows.filter(e=>e.selected);this._allRowsSelected=e;this.rows.forEach(t=>{t.selected=e});const s=e?this.rows:[];this.fireEvent("selection-change",{selectedRows:s,previouslySelectedRows:t})}getRowParent(e){if(e.hasAttribute("ui5-table-row")){return e}const t=e.parentElement;if(!t){return}if(t.hasAttribute("ui5-table-row")){return t}return this.getRowParent(t)}get columnHeader(){const e=this.getDomRef();return e?e.querySelector(`#${this._id}-columnHeader`):null}get"morеBtn"(){const e=this.getDomRef();if(this.growsWithButton&&e){return e.querySelector(`#${this._id}-growingButton`)}return null}handleResize(){this.checkTableInViewport();this.popinContent()}checkTableInViewport(){this._inViewport=(0,b.default)(this.getDomRef())}popinContent(){const e=this.getDomRef().getBoundingClientRect();const t=e.width;const s=[];const i=[];this.columns.forEach((e,o)=>{if(t<e.minWidth&&e.minWidth!==Infinity){s[o]={index:o,popinText:e.popinText,demandPopin:e.demandPopin}}else{i.push(o)}});if(i.length){if(!this.isMultiSelect){this.columns[i[0]].first=true}this.columns[i[i.length-1]].last=true}const o=this._hiddenColumns.length!==s.length||this._hiddenColumns.some((e,t)=>e!==s[t]);if(o){this._hiddenColumns=s;if(s.length){this.fireEvent("popin-change",{poppedColumns:this._hiddenColumns})}}}getColumnPropagationSettings(){return this.columns.map((e,t)=>({index:t,minWidth:e.minWidth,demandPopin:e.demandPopin,text:e.textContent,popinText:e.popinText,popinDisplay:e.popinDisplay,visible:!this._hiddenColumns[t]}),this)}getIntersectionObserver(){if(!this.growingIntersectionObserver){this.growingIntersectionObserver=new IntersectionObserver(this.onInteresection.bind(this),{root:document,rootMargin:"0px",threshold:1})}return this.growingIntersectionObserver}get styles(){return{busy:{position:this.busyIndPosition}}}get growsWithButton(){return this.growing===_.default.Button}get growsOnScroll(){return this.growing===_.default.Scroll}get _growingButtonText(){return this.growingButtonText||B.i18nBundle.getText(R.LOAD_MORE_TEXT)}get ariaLabelText(){const e=this.rows.length+1;const t=B.i18nBundle.getText(R.TABLE_HEADER_ROW_INFORMATION,e);const s=this.columns.map(e=>e.textContent.trim()).join(" ");return`${t} ${s}`}get tableAriaLabelText(){return(0,p.getEffectiveAriaLabelText)(this)}get ariaLabelSelectAllText(){return B.i18nBundle.getText(R.ARIA_LABEL_SELECT_ALL_CHECKBOX)}get loadMoreAriaLabelledBy(){if(this.moreDataText){return`${this._id}-growingButton-text ${this._id}-growingButton-subtext`}return`${this._id}-growingButton-text`}get tableEndDOM(){return this.shadowRoot.querySelector(".ui5-table-end-marker")}get busyIndPosition(){return this._inViewport?"absolute":"sticky"}get isMultiSelect(){return this.mode===y.default.MultiSelect}get isSingleSelect(){return this.mode===y.default.SingleSelect}get selectedRows(){return this.rows.filter(e=>e.selected)}get currentItemIdx(){return this.rows.indexOf(this.currentItem)}get currentItem(){return this.getRootNode().activeElement}get currentElement(){return this._itemNavigation._getCurrentItem()}get columnHeaderTabbables(){return this.columnHeader?(0,m.getTabbableElements)(this.columnHeader):[]}get columnHeaderLastElement(){return this.columnHeader&&(0,m.getLastTabbableElement)(this.columnHeader)}};T([(0,i.default)()],M.prototype,"noDataText",void 0);T([(0,i.default)()],M.prototype,"growingButtonText",void 0);T([(0,i.default)()],M.prototype,"growingButtonSubtext",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"hideNoData",void 0);T([(0,i.default)({type:_.default,defaultValue:_.default.None})],M.prototype,"growing",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"busy",void 0);T([(0,i.default)({validator:d.default,defaultValue:1e3})],M.prototype,"busyDelay",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"stickyColumnHeader",void 0);T([(0,i.default)({type:y.default,defaultValue:y.default.None})],M.prototype,"mode",void 0);T([(0,i.default)({defaultValue:undefined})],M.prototype,"accessibleName",void 0);T([(0,i.default)({defaultValue:""})],M.prototype,"accessibleNameRef",void 0);T([(0,i.default)({type:Object,multiple:true})],M.prototype,"_hiddenColumns",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"_noDataDisplayed",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"_loadMoreActive",void 0);T([(0,i.default)({type:Object})],M.prototype,"_columnHeader",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"_inViewport",void 0);T([(0,i.default)({type:Boolean})],M.prototype,"_allRowsSelected",void 0);T([(0,n.default)({type:HTMLElement,default:true,individualSlots:true,invalidateOnChildChange:true})],M.prototype,"rows",void 0);T([(0,n.default)({type:HTMLElement,individualSlots:true,invalidateOnChildChange:{properties:true,slots:false}})],M.prototype,"columns",void 0);M=B=T([(0,s.default)({tag:"ui5-table",fastNavigation:true,styles:C.default,renderer:r.default,template:S.default,dependencies:[v.default,E.default]}),(0,o.default)("row-click",{detail:{row:{type:HTMLElement}}}),(0,o.default)("popin-change",{detail:{poppedColumns:{type:Array}}}),(0,o.default)("load-more"),(0,o.default)("selection-change",{detail:{selectedRows:{type:Array},previouslySelectedRows:{type:Array}}})],M);M.define();var O=M;e.default=O});
//# sourceMappingURL=Table.js.map