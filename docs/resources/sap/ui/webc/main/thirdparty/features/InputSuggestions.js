sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/base/security/encodeXML","sap/ui/webc/common/thirdparty/base/util/generateHighlightedMarkup","../List","../ResponsivePopover","../SuggestionItem","../SuggestionGroupItem","../Button","../Icon","../Popover","../GroupHeaderListItem","../SuggestionListItem","../generated/i18n/i18n-defaults"],function(e,t,s,i,n,o,r,u,c,h,a,l,d,m,I){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;i=g(i);n=g(n);o=g(o);r=g(r);u=g(u);c=g(c);h=g(h);a=g(a);l=g(l);d=g(d);m=g(m);function g(e){return e&&e.__esModule?e:{default:e}}class p{constructor(e,t,s,i){this.component=e;this.slotName=t;this.handleFocus=i;this.highlight=s;this.fnOnSuggestionItemPress=this.onItemPress.bind(this);this.fnOnSuggestionItemMouseOver=this.onItemMouseOver.bind(this);this.fnOnSuggestionItemMouseOut=this.onItemMouseOut.bind(this);this._getSuggestionPopover();this.selectedItemIndex=-1}defaultSlotProperties(e){const t=this._getComponent().suggestionItems;const s=this.highlight&&!!e;const i=[];t.map((t,n)=>{const o=s?this.getHighlightedText(t,e):this.getRowText(t);const r=s?this.getHighlightedDesc(t,e):this.getRowDesc(t);return i.push({text:o,description:r,image:t.image||undefined,icon:t.icon||undefined,type:t.type||undefined,additionalText:t.additionalText||undefined,additionalTextState:t.additionalTextState,groupItem:t.groupItem,key:n})});return i}onUp(e){e.preventDefault();this._handleItemNavigation(false);return true}onDown(e){e.preventDefault();this._handleItemNavigation(true);return true}onSpace(e){if(this._isItemOnTarget()){e.preventDefault();this.onItemSelected(null,true);return true}return false}onEnter(e){if(this._isGroupOrInactiveItem){e.preventDefault();return false}if(this._isItemOnTarget()){this.onItemSelected(null,true);return true}return false}onPageUp(e){e.preventDefault();const t=this.selectedItemIndex-10>-1;if(this._hasValueState&&!t){this._focusValueState();return true}this._moveItemSelection(this.selectedItemIndex,t?this.selectedItemIndex-=10:this.selectedItemIndex=0);return true}onPageDown(e){e.preventDefault();const t=this._getItems();const s=t.length-1;const i=this.selectedItemIndex+10<=s;if(this._hasValueState&&!t){this._focusValueState();return true}this._moveItemSelection(this.selectedItemIndex,i?this.selectedItemIndex+=10:this.selectedItemIndex=s);return true}onHome(e){e.preventDefault();if(this._hasValueState){this._focusValueState();return true}this._moveItemSelection(this.selectedItemIndex,this.selectedItemIndex=0);return true}onEnd(e){e.preventDefault();const t=this._getItems().length-1;if(this._hasValueState&&!t){this._focusValueState();return true}this._moveItemSelection(this.selectedItemIndex,this.selectedItemIndex=t);return true}onTab(){if(this._isItemOnTarget()){this.onItemSelected(null,true);return true}return false}toggle(e,t){const s=e!==undefined?e:!this.isOpened();if(s){this.open()}else{this.close(t.preventFocusRestore)}}async _isScrollable(){const e=await this._getScrollContainer();return e.offsetHeight<e.scrollHeight}open(){this._getComponent().open=true;this._beforeOpen();this.responsivePopover.showAt(this._getComponent())}async close(e=false){const t=this._getItems()&&this._getItems()[this.selectedItemIndex];this._getComponent().open=false;this.responsivePopover=await this._getSuggestionPopover();this.responsivePopover.close(false,false,e);if(t&&t.focused){t.focused=false}}updateSelectedItemPosition(e){this.selectedItemIndex=e}onItemMouseOver(e){this._getComponent().onItemMouseOver(e)}onItemMouseOut(e){this._getComponent().onItemMouseOut(e)}onItemSelected(e,t){const s=this._getItems();const i=e||s[this.selectedItemIndex];const n=this._getNonGroupItems();this.selectedItemIndex=s.indexOf(i);this.accInfo={isGroup:i.groupItem,currentPos:n.indexOf(i)+1,listSize:n.length,itemText:this._getRealItems()[this.selectedItemIndex].text,description:this._getRealItems()[this.selectedItemIndex].description};if(i.type==="Inactive"||i.groupItem){return}this._getComponent().onItemSelected(this._getRealItems()[this.selectedItemIndex],t);i.selected=false;i.focused=false;this._getComponent().open=false}onItemPreviewed(e){this._getComponent().onItemPreviewed(e)}onItemPress(e){let t;const s=e.type==="ui5-item-click";if(s&&!e.detail.item.selected||this._handledPress&&!s){return}if(s&&e.detail.item.selected){t=e.detail.item;this._handledPress=true}else{t=e.detail.selectedItems[0]}this.onItemSelected(t,false)}_beforeOpen(){this._attachItemsListeners();this._attachPopupListeners()}async _attachItemsListeners(){const e=await this._getList();e.removeEventListener("ui5-item-click",this.fnOnSuggestionItemPress);e.addEventListener("ui5-item-click",this.fnOnSuggestionItemPress);e.removeEventListener("ui5-selection-change",this.fnOnSuggestionItemPress);e.addEventListener("ui5-selection-change",this.fnOnSuggestionItemPress);e.removeEventListener("mouseover",this.fnOnSuggestionItemMouseOver);e.addEventListener("mouseover",this.fnOnSuggestionItemMouseOver);e.removeEventListener("mouseout",this.fnOnSuggestionItemMouseOut);e.addEventListener("mouseout",this.fnOnSuggestionItemMouseOut)}_attachPopupListeners(){if(!this.handleFocus){return}if(!this.attachedAfterOpened){this.responsivePopover.addEventListener("ui5-after-open",this._onOpen.bind(this));this.attachedAfterOpened=true}if(!this.attachedAfterClose){this.responsivePopover.addEventListener("ui5-after-close",this._onClose.bind(this));this.attachedAfterClose=true}}_onOpen(){this._applyFocus()}_onClose(){this._handledPress=false}_applyFocus(){if(this.selectedItemIndex){this._getItems()[this.selectedItemIndex].focus()}}_isItemOnTarget(){return this.isOpened()&&this.selectedItemIndex!==null&&this.selectedItemIndex!==-1&&!this._isGroupOrInactiveItem}get _isGroupOrInactiveItem(){const e=this._getItems();if(!e||!e[this.selectedItemIndex]){return false}return e[this.selectedItemIndex].groupItem||e[this.selectedItemIndex].type==="Inactive"}isOpened(){return!!(this.responsivePopover&&this.responsivePopover.opened)}_handleItemNavigation(e){if(!this._getItems().length){return}if(e){this._selectNextItem()}else{this._selectPreviousItem()}}_selectNextItem(){const e=this._getItems().length;const t=this.selectedItemIndex;if(this._hasValueState&&t===-1&&!this.component._isValueStateFocused){this._focusValueState();return}if(t===-1&&!this._hasValueState||this.component._isValueStateFocused){this._clearValueStateFocus();this.selectedItemIndex=-1}if(t!==-1&&t+1>e-1){return}this._moveItemSelection(t,++this.selectedItemIndex)}_selectPreviousItem(){const e=this._getItems();const t=this.selectedItemIndex;if(this._hasValueState&&t===0&&!this.component._isValueStateFocused){this.component.hasSuggestionItemSelected=false;this.component._isValueStateFocused=true;this.selectedItemIndex=0;e[0].focused=false;e[0].selected=false;return}if(this.component._isValueStateFocused){this.component.focused=true;this.component._isValueStateFocused=false;this.selectedItemIndex=0;return}if(t===-1||t===null){return}if(t-1<0){e[t].selected=false;e[t].focused=false;this.component.focused=true;this.component.hasSuggestionItemSelected=false;this.selectedItemIndex-=1;return}this._moveItemSelection(t,--this.selectedItemIndex)}_moveItemSelection(e,t){const s=this._getItems();const i=s[t];const n=s[e];const o=this._getNonGroupItems();if(!i){return}this.component.focused=false;this._clearValueStateFocus();this.accInfo={isGroup:i.groupItem,currentPos:o.indexOf(i)+1,listSize:o.length,itemText:this._getRealItems()[this.selectedItemIndex].text,description:this._getRealItems()[s.indexOf(i)].description};if(n){n.selected=false;n.focused=false}if(i){i.focused=true;if(i.type==="Active"){i.selected=true}if(this.handleFocus){i.focus()}}this.component.hasSuggestionItemSelected=true;this.onItemPreviewed(i);if(!this._isItemIntoView(i)){this._scrollItemIntoView(i)}}_deselectItems(){const e=this._getItems();e.forEach(e=>{e.selected=false;e.focused=false})}_clearItemFocus(){const e=this._getItems().find(e=>e.focused);if(e){e.focused=false}}_isItemIntoView(e){const t=e.getDomRef().getBoundingClientRect();const s=this._getComponent().getDomRef().getBoundingClientRect();const i=window.innerHeight||document.documentElement.clientHeight;return t.top+p.SCROLL_STEP<=i&&t.top>=s.top}async _scrollItemIntoView(e){const t=e.getDomRef().offsetTop;const s=await this._getScrollContainer();s.scrollTop=t}async _getScrollContainer(){if(!this._scrollContainer){await this._getSuggestionPopover();this._scrollContainer=this.responsivePopover.shadowRoot.querySelector(".ui5-popup-content")}return this._scrollContainer}_getItems(){return this.responsivePopover?[...this.responsivePopover.querySelector("[ui5-list]").children]:[]}_getNonGroupItems(){return this._getItems().filter(e=>!e.groupItem)}_getComponent(){return this.component}async _getList(){this.responsivePopover=await this._getSuggestionPopover();return this.responsivePopover.querySelector("[ui5-list]")}async _getListWidth(){const e=await this._getList();return e.offsetWidth}_getRealItems(){return this._getComponent().getSlottedNodes(this.slotName)}async _getSuggestionPopover(){if(this.responsivePopover){return this.responsivePopover}const e=await this._getComponent().getStaticAreaItemDomRef();this.responsivePopover=e.querySelector("[ui5-responsive-popover]");return this.responsivePopover}get itemSelectionAnnounce(){if(!this.accInfo){return""}const e=p.i18nBundle.getText(I.LIST_ITEM_POSITION,this.accInfo.currentPos,this.accInfo.listSize);const t=p.i18nBundle.getText(I.LIST_ITEM_GROUP_HEADER);return this.accInfo.isGroup?`${t} ${this.accInfo.itemText}`:`${this.accInfo.description} ${e}`}getRowText(e){return this.sanitizeText(e.text||e.textContent||"")}getRowDesc(e){return this.sanitizeText(e.description||"")}getHighlightedText(e,t){const s=e.text||e.textContent||"";return this.hightlightInput(s,t)}getHighlightedDesc(e,t){const s=e.description;return this.hightlightInput(s,t)}hightlightInput(e,t){return(0,n.default)(e,t)}sanitizeText(e){return(0,i.default)(e)}get _hasValueState(){return this.component.hasValueStateMessage}_focusValueState(){const e=this._getItems();this.component._isValueStateFocused=true;this.component.focused=false;this.component.hasSuggestionItemSelected=false;this.selectedItemIndex=0;this.component.value=this.component.typedInValue;e&&this._scrollItemIntoView(e[0]);this._deselectItems()}_clearValueStateFocus(){this.component._isValueStateFocused=false}static get dependencies(){return[u.default,c.default,r.default,o.default,m.default,d.default,h.default,a.default,l.default]}static async init(){p.i18nBundle=await(0,s.getI18nBundle)("@ui5/webcomponents")}}p.SCROLL_STEP=60;(0,t.registerFeature)("InputSuggestions",p);var f=p;e.default=f});
//# sourceMappingURL=InputSuggestions.js.map