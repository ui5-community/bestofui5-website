sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/decorators/customElement","sap/ui/webc/common/thirdparty/base/decorators/property","sap/ui/webc/common/thirdparty/base/decorators/slot","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/DOMReference","sap/ui/webc/common/thirdparty/base/util/PopupUtils","sap/ui/webc/common/thirdparty/base/util/clamp","./Popup","./types/PopoverPlacementType","./types/PopoverVerticalAlign","./types/PopoverHorizontalAlign","./popup-utils/PopoverRegistry","./generated/templates/PopoverTemplate.lit","./generated/themes/BrowserScrollbar.css","./generated/themes/PopupsCommon.css","./generated/themes/Popover.css"],function(t,e,o,i,r,a,l,s,n,h,d,p,u,f,c,g,m,y){"use strict";Object.defineProperty(t,"__esModule",{value:true});t.instanceOfPopover=t.default=void 0;e=w(e);o=w(o);i=w(i);r=w(r);l=w(l);n=w(n);h=w(h);d=w(d);p=w(p);u=w(u);c=w(c);g=w(g);m=w(m);y=w(y);function w(t){return t&&t.__esModule?t:{default:t}}var _=void 0&&(void 0).__decorate||function(t,e,o,i){var r=arguments.length,a=r<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,o):i,l;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")a=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)if(l=t[s])a=(r<3?l(a):r>3?l(e,o,a):l(e,o))||a;return r>3&&a&&Object.defineProperty(e,o,a),a};var b;const v=8;let P=b=class t extends h.default{static get VIEWPORT_MARGIN(){return 10}constructor(){super()}onAfterRendering(){if(!this.isOpen()&&this.open){let t;if(this.opener instanceof HTMLElement){t=this.opener}else if(typeof this.opener==="string"){t=this.getRootNode().getElementById(this.opener)}if(!t){console.warn("Valid opener id is required.");return}this.showAt(t)}else if(this.isOpen()&&!this.open){this.close()}}isOpenerClicked(t){const e=t.target;if(e===this._opener){return true}const o=e;if(o.getFocusDomRef&&o.getFocusDomRef()===this._opener){return true}return t.composedPath().indexOf(this._opener)>-1}async showAt(t,e=false){if(!t||this.opened){return}this._opener=t;this._openerRect=t.getBoundingClientRect();await super._open(e)}_addOpenedPopup(){(0,sap.ui.require("sap/ui/webc/main/thirdparty/popup-utils/PopoverRegistry").addOpenedPopover)(this)}_removeOpenedPopup(){(0,sap.ui.require("sap/ui/webc/main/thirdparty/popup-utils/PopoverRegistry").removeOpenedPopover)(this)}shouldCloseDueToOverflow(t,e){const o=32;const i={Right:e.right,Left:e.left,Top:e.top,Bottom:e.bottom};const r=(0,s.getClosedPopupParent)(this._opener);let a=false;let l=false;if(r.showAt){const t=r.contentDOM.getBoundingClientRect();a=e.top>t.top+t.height;l=e.top+e.height<t.top}return i[t]<0||i[t]+o>r.innerHeight||a||l}shouldCloseDueToNoOpener(t){return t.top===0&&t.bottom===0&&t.left===0&&t.right===0}isOpenerOutsideViewport(t){return t.bottom<0||t.top>window.innerHeight||t.right<0||t.left>window.innerWidth}_resize(){super._resize();if(this.opened){this.reposition()}}reposition(){this._show()}_show(){let t;const e=this.getPopoverSize();if(e.width===0||e.height===0){return}if(this.isOpen()){this._openerRect=this._opener.getBoundingClientRect()}if(this.shouldCloseDueToNoOpener(this._openerRect)&&this.isFocusWithin()){t=this._oldPlacement}else{t=this.calcPlacement(this._openerRect,e)}if(this._preventRepositionAndClose||this.isOpenerOutsideViewport(this._openerRect)){return this.close()}this._oldPlacement=t;this.actualPlacementType=t.placementType;let o=(0,n.default)(this._left,b.VIEWPORT_MARGIN,document.documentElement.clientWidth-e.width-b.VIEWPORT_MARGIN);if(this.actualPlacementType===d.default.Right){o=Math.max(o,this._left)}let i=(0,n.default)(this._top,b.VIEWPORT_MARGIN,document.documentElement.clientHeight-e.height-b.VIEWPORT_MARGIN);if(this.actualPlacementType===d.default.Bottom){i=Math.max(i,this._top)}this.arrowTranslateX=t.arrow.x;this.arrowTranslateY=t.arrow.y;i=this._adjustForIOSKeyboard(i);Object.assign(this.style,{top:`${i}px`,left:`${o}px`});super._show();if(this.horizontalAlign===u.default.Stretch&&this._width){this.style.width=this._width}}_adjustForIOSKeyboard(t){if(!(0,a.isIOS)()){return t}const e=Math.ceil(this.getBoundingClientRect().top);return t+(Number.parseInt(this.style.top||"0")-e)}getPopoverSize(){if(!this.opened){Object.assign(this.style,{display:"block",top:"-10000px",left:"-10000px"})}const t=this.getBoundingClientRect(),e=t.width,o=t.height;return{width:e,height:o}}get arrowDOM(){return this.shadowRoot.querySelector(".ui5-popover-arrow")}calcPlacement(t,e){let o=0;let i=0;const r=this.allowTargetOverlap;const a=document.documentElement.clientWidth;const l=document.documentElement.clientHeight;let s=l;let n=a;const h=this.getActualPlacementType(t,e);this._preventRepositionAndClose=this.shouldCloseDueToNoOpener(t)||this.shouldCloseDueToOverflow(h,t);const f=h===d.default.Top||h===d.default.Bottom;if(this.horizontalAlign===u.default.Stretch&&f){e.width=t.width;this._width=`${t.width}px`}else if(this.verticalAlign===p.default.Stretch&&!f){e.height=t.height}const c=this.hideArrow?0:v;switch(h){case d.default.Top:o=this.getVerticalLeft(t,e);i=Math.max(t.top-e.height-c,0);if(!r){s=t.top-c}break;case d.default.Bottom:o=this.getVerticalLeft(t,e);i=t.bottom+c;if(r){i=Math.max(Math.min(i,l-e.height),0)}else{s=l-t.bottom-c}break;case d.default.Left:o=Math.max(t.left-e.width-c,0);i=this.getHorizontalTop(t,e);if(!r){n=t.left-c}break;case d.default.Right:o=t.left+t.width+c;i=this.getHorizontalTop(t,e);if(r){o=Math.max(Math.min(o,a-e.width),0)}else{n=a-t.right-c}break}if(f){if(e.width>a||o<0){o=0}else if(o+e.width>a){o-=o+e.width-a}}else{if(e.height>l||i<0){i=0}else if(i+e.height>l){i-=i+e.height-l}}this._maxHeight=Math.round(s-b.VIEWPORT_MARGIN);this._maxWidth=Math.round(n-b.VIEWPORT_MARGIN);if(this._left===undefined||Math.abs(this._left-o)>1.5){this._left=Math.round(o)}if(this._top===undefined||Math.abs(this._top-i)>1.5){this._top=Math.round(i)}const g=Number.parseInt(window.getComputedStyle(this).getPropertyValue("border-radius"));const m=this.getArrowPosition(t,e,o,i,f,g);return{arrow:m,top:this._top,left:this._left,placementType:h}}getArrowPosition(t,e,o,i,r,a){const l=this._actualHorizontalAlign;let s=l===u.default.Center||l===u.default.Stretch;if(l===u.default.Right&&o<=t.left){s=true}if(l===u.default.Left&&o+e.width>=t.left+t.width){s=true}let h=0;if(r&&s){h=t.left+t.width/2-o-e.width/2}let d=0;if(!r){d=t.top+t.height/2-i-e.height/2}const p=e.height/2-a-v/2;d=(0,n.default)(d,-p,p);const f=e.width/2-a-v/2;h=(0,n.default)(h,-f,f);return{x:Math.round(h),y:Math.round(d)}}fallbackPlacement(t,e,o,i){if(o.left>i.width){return d.default.Left}if(t-o.right>o.left){return d.default.Right}if(e-o.bottom>i.height){return d.default.Bottom}if(e-o.bottom<o.top){return d.default.Top}}getActualPlacementType(t,e){const o=this.placementType;let i=o;const r=document.documentElement.clientWidth;const a=document.documentElement.clientHeight;switch(o){case d.default.Top:if(t.top<e.height&&t.top<a-t.bottom){i=d.default.Bottom}break;case d.default.Bottom:if(a-t.bottom<e.height&&a-t.bottom<t.top){i=d.default.Top}break;case d.default.Left:if(t.left<e.width){i=this.fallbackPlacement(r,a,t,e)||o}break;case d.default.Right:if(r-t.right<e.width){i=this.fallbackPlacement(r,a,t,e)||o}break}return i}getVerticalLeft(t,e){const o=this._actualHorizontalAlign;let i=0;switch(o){case u.default.Center:case u.default.Stretch:i=t.left-(e.width-t.width)/2;break;case u.default.Left:i=t.left;break;case u.default.Right:i=t.right-e.width;break}return i}getHorizontalTop(t,e){let o=0;switch(this.verticalAlign){case p.default.Center:case p.default.Stretch:o=t.top-(e.height-t.height)/2;break;case p.default.Top:o=t.top;break;case p.default.Bottom:o=t.bottom-e.height;break}return o}get isModal(){return this.modal}get shouldHideBackdrop(){return this.hideBackdrop}get _ariaLabelledBy(){if(!this._ariaLabel&&this._displayHeader){return"ui5-popup-header"}return undefined}get styles(){return{...super.styles,root:{"max-height":this._maxHeight?`${this._maxHeight}px`:"","max-width":this._maxWidth?`${this._maxWidth}px`:""},arrow:{transform:`translate(${this.arrowTranslateX}px, ${this.arrowTranslateY}px)`}}}get classes(){const t=super.classes;t.root["ui5-popover-root"]=true;return t}get _displayHeader(){return!!(this.header.length||this.headerText)}get _displayFooter(){return true}get _actualHorizontalAlign(){if(this.effectiveDir==="rtl"){if(this.horizontalAlign===u.default.Left){return u.default.Right}if(this.horizontalAlign===u.default.Right){return u.default.Left}}return this.horizontalAlign}};_([(0,o.default)()],P.prototype,"headerText",void 0);_([(0,o.default)({type:d.default,defaultValue:d.default.Right})],P.prototype,"placementType",void 0);_([(0,o.default)({type:u.default,defaultValue:u.default.Center})],P.prototype,"horizontalAlign",void 0);_([(0,o.default)({type:p.default,defaultValue:p.default.Center})],P.prototype,"verticalAlign",void 0);_([(0,o.default)({type:Boolean})],P.prototype,"modal",void 0);_([(0,o.default)({type:Boolean})],P.prototype,"hideBackdrop",void 0);_([(0,o.default)({type:Boolean})],P.prototype,"hideArrow",void 0);_([(0,o.default)({type:Boolean})],P.prototype,"allowTargetOverlap",void 0);_([(0,o.default)({validator:l.default})],P.prototype,"opener",void 0);_([(0,o.default)({type:Boolean})],P.prototype,"disableScrolling",void 0);_([(0,o.default)({validator:r.default,defaultValue:0,noAttribute:true})],P.prototype,"arrowTranslateX",void 0);_([(0,o.default)({validator:r.default,defaultValue:0,noAttribute:true})],P.prototype,"arrowTranslateY",void 0);_([(0,o.default)({type:d.default,defaultValue:d.default.Right})],P.prototype,"actualPlacementType",void 0);_([(0,o.default)({validator:r.default,noAttribute:true})],P.prototype,"_maxHeight",void 0);_([(0,o.default)({validator:r.default,noAttribute:true})],P.prototype,"_maxWidth",void 0);_([(0,i.default)({type:HTMLElement})],P.prototype,"header",void 0);_([(0,i.default)({type:HTMLElement})],P.prototype,"footer",void 0);P=b=_([(0,e.default)({tag:"ui5-popover",styles:[g.default,m.default,y.default],template:c.default})],P);const R=t=>"showAt"in t;t.instanceOfPopover=R;P.define();var T=P;t.default=T});
//# sourceMappingURL=Popover.js.map