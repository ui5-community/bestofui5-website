sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/decorators/property","sap/ui/webc/common/thirdparty/base/decorators/slot","sap/ui/webc/common/thirdparty/base/decorators/event","sap/ui/webc/common/thirdparty/base/decorators/customElement","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/delegate/ResizeHandler","sap/ui/webc/common/thirdparty/base/delegate/ItemNavigation","sap/ui/webc/common/thirdparty/base/delegate/ScrollEnablement","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/Keys","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/ValueState","./ResponsivePopover","./List","./Title","./Button","./StandardListItem","./generated/templates/TokenizerTemplate.lit","./generated/templates/TokenizerPopoverTemplate.lit","./generated/i18n/i18n-defaults","./generated/themes/Tokenizer.css","./generated/themes/TokenizerPopover.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/Suggestions.css"],function(e,t,o,n,i,s,r,l,a,d,h,u,c,f,p,g,m,_,v,T,k,b,S,E,C,w,y,x){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=e.ClipboardDataOperation=void 0;t=D(t);o=D(o);n=D(n);i=D(i);s=D(s);r=D(r);l=D(l);a=D(a);d=D(d);h=D(h);p=D(p);g=D(g);m=D(m);_=D(_);v=D(v);T=D(T);k=D(k);b=D(b);E=D(E);C=D(C);w=D(w);y=D(y);x=D(x);function D(e){return e&&e.__esModule?e:{default:e}}var N=void 0&&(void 0).__decorate||function(e,t,o,n){var i=arguments.length,s=i<3?t:n===null?n=Object.getOwnPropertyDescriptor(t,o):n,r;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")s=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)if(r=e[l])s=(i<3?r(s):i>3?r(t,o,s):r(t,o))||s;return i>3&&s&&Object.defineProperty(t,o,s),s};var I;var M;e.ClipboardDataOperation=M;(function(e){e["cut"]="cut";e["copy"]="copy"})(M||(e.ClipboardDataOperation=M={}));let O=I=class e extends t.default{_handleResize(){this._nMoreCount=this.overflownTokens.length}constructor(){super();this._resizeHandler=this._handleResize.bind(this);this._itemNav=new a.default(this,{currentIndex:-1,getItemsCallback:this._getVisibleTokens.bind(this)});this._scrollEnablement=new d.default(this)}onBeforeRendering(){this._nMoreCount=this.overflownTokens.length;this._tokensCount=this._getTokens().length;this._tokens.forEach(e=>{e.singleToken=this._tokens.length===1});if(!this._tokens.length){this.closeMorePopover()}}onEnterDOM(){l.default.register(this.contentDom,this._resizeHandler)}onExitDOM(){l.default.deregister(this.contentDom,this._resizeHandler)}async _openMorePopoverAndFireEvent(){if(!this.preventPopoverOpen){await this.openMorePopover()}this.fireEvent("show-more-items-press")}async openMorePopover(){(await this.getPopover()).showAt(this.morePopoverOpener||this)}_getTokens(){return this.getSlottedNodes("tokens")}get _tokens(){return this.getSlottedNodes("tokens")}_onmousedown(e){if(e.target.hasAttribute("ui5-token")){const t=e.target;if(!t.toBeDeleted){this._itemNav.setCurrentItem(t)}}}onTokenSelect(){const e=this._getTokens();if(e.length===1&&e[0].isTruncatable){if(e[0].selected){this.openMorePopover()}else{this.closeMorePopover()}}}_getVisibleTokens(){if(this.disabled){return[]}return this._tokens.filter((e,t)=>t<this._tokens.length-this._nMoreCount)}async onAfterRendering(){if(!this._getTokens().length){const e=await this.getPopover();e.close()}this._scrollEnablement.scrollContainer=this.expanded||!this.narrowContentDom?this.expandedContentDom:this.narrowContentDom;if(this.expanded){this._expandedScrollWidth=this.expandedContentDom.scrollWidth;this.scrollToEnd()}if(!this.expanded){this.scrollToStart()}}_delete(e){const t=e.target;if(!e.detail){this._tokenClickDelete(e,t);if(this._getTokens().length){this.closeMorePopover()}return}if(this._selectedTokens.length){this._selectedTokens.forEach(t=>this.deleteToken(t,e.detail.backSpace))}else{this.deleteToken(t,e.detail.backSpace)}}_tokenClickDelete(e,t){const o=this._getVisibleTokens();const n=e.target;const i=t?o.indexOf(t):o.indexOf(n);const s=i===o.length-1?i-1:i+1;const r=o[s];this._handleCurrentItemAfterDeletion(r);this.fireEvent("token-delete",{ref:t||n})}_handleCurrentItemAfterDeletion(e){if(e&&!(0,f.isPhone)()){this._itemNav.setCurrentItem(e);setTimeout(()=>{e.focus()},0)}}deleteToken(e,t){const o=this._getVisibleTokens();const n=o.indexOf(e);let i=n===o.length-1?n-1:n+1;const s=o.filter(e=>!e.selected);if(t){i=n===0?n+1:n-1}else{i=n===o.length-1?n-1:n+1}let r=o[i];if(s.length>1){while(r&&r.selected){r=t?o[--i]:o[++i]}}else{r=s[0]}this._handleCurrentItemAfterDeletion(r);this.fireEvent("token-delete",{ref:e})}async itemDelete(e){const t=e.detail.item.tokenRef;if(this._getTokens().length===1&&this._getTokens()[0].isTruncatable){const e=await this.getPopover();e.addEventListener("ui5-after-close",()=>{this.fireEvent("token-delete",{ref:t})},{once:true});e.close()}else{this.fireEvent("token-delete",{ref:t})}}handleBeforeClose(){if((0,f.isPhone)()){this._getTokens().forEach(e=>{e.selected=false})}}handleBeforeOpen(){this.fireEvent("before-more-popover-open")}_onkeydown(e){if((0,c.isSpaceShift)(e)){e.preventDefault()}if((0,c.isSpace)(e)||(0,c.isSpaceCtrl)(e)){e.preventDefault();return this._handleTokenSelection(e,false)}if((0,c.isHomeShift)(e)){this._handleHomeShift(e)}if((0,c.isEndShift)(e)){this._handleEndShift(e)}this._handleItemNavigation(e,this._tokens)}_handleItemNavigation(e,t){const o=!!(e.metaKey||e.ctrlKey);const n=e.target;if((0,c.isLeftCtrl)(e)||(0,c.isRightCtrl)(e)||(0,c.isDownCtrl)(e)||(0,c.isUpCtrl)(e)){return this._handleArrowCtrl(e,n,t,(0,c.isRightCtrl)(e)||(0,c.isDownCtrl)(e))}if((0,c.isLeftShift)(e)||(0,c.isRightShift)(e)||(0,c.isUpShift)(e)||(0,c.isDownShift)(e)||(0,c.isLeftShiftCtrl)(e)||(0,c.isRightShiftCtrl)(e)){e.preventDefault();return this._handleArrowShift(n,t,(0,c.isRightShift)(e)||(0,c.isRightShiftCtrl)(e)||(0,c.isDownShift)(e))}if((0,c.isHome)(e)||(0,c.isEnd)(e)||(0,c.isHomeCtrl)(e)||(0,c.isEndCtrl)(e)){e.preventDefault();return this._handleHome(t,(0,c.isEnd)(e)||(0,c.isEndCtrl)(e))}if(o&&e.key.toLowerCase()==="a"){e.preventDefault();return this._toggleTokenSelection(t)}if((0,c.isLeft)(e)||(0,c.isRight)(e)||(0,c.isUp)(e)||(0,c.isDown)(e)){const o=this._calcNextTokenIndex(this._tokens.find(e=>e.focused),t,(0,c.isRight)(e)||(0,c.isDown)(e));this._scrollToToken(t[o])}}_handleHome(e,t){if(!e||!e.length){return-1}const o=t?e.length-1:0;e[o].focus();this._itemNav.setCurrentItem(e[o])}_handleHomeShift(e){const t=this.tokens;const o=e.target;const n=t.indexOf(o);t.filter((e,t)=>t<=n).forEach(e=>{e.selected=true});t[0].focus();this._itemNav.setCurrentItem(t[0])}_handleEndShift(e){const t=this.tokens;const o=e.target;const n=t.indexOf(o);t.filter((e,t)=>t>=n).forEach(e=>{e.selected=true});t[t.length-1].focus();this._itemNav.setCurrentItem(t[t.length-1])}_calcNextTokenIndex(e,t,o){if(!t.length){return-1}const n=t.indexOf(e);let i=o?n+1:n-1;if(i>=t.length){i=t.length-1}if(i<0){i=0}return i}_handleArrowCtrl(e,t,o,n){const i=this._calcNextTokenIndex(t,o,n);e.preventDefault();if(i===-1){return}setTimeout(()=>{o[i].focus()},0);this._scrollToToken(o[i]);this._itemNav.setCurrentItem(o[i])}_handleArrowShift(e,t,o){const n=t.indexOf(e);const i=o?n+1:n-1;if(i===-1||i===t.length){return}e.selected=true;t[i].selected=true;setTimeout(()=>{t[i].focus()},0);this._scrollToToken(t[i]);this._itemNav.setCurrentItem(t[i])}_click(e){this._handleTokenSelection(e)}_toggleTokenSelection(e){if(!e||!e.length){return}const t=e.every(e=>e.selected);e.forEach(e=>{e.selected=!t})}_handleTokenSelection(e,t=true){const o=e.target;if(o.hasAttribute("ui5-token")){const e=t?this._tokens:[];e.forEach(e=>{if(e!==o){e.selected=false}})}}_fillClipboard(e,t){const o=t.filter(e=>e.selected).map(e=>e.text).join("\r\n");const n=e=>{if(e.clipboardData){e.clipboardData.setData("text/plain",o)}e.preventDefault()};document.addEventListener(e,n);document.execCommand(e);document.removeEventListener(e,n)}scrollToStart(){if(this._scrollEnablement.scrollContainer){this._scrollEnablement.scrollTo(0,0)}}scrollToEnd(){const e=this.expandedContentDom&&(this.effectiveDir!=="rtl"?this.expandedContentDom.scrollWidth:-this.expandedContentDom.scrollWidth);if(this._scrollEnablement.scrollContainer){this._scrollEnablement.scrollTo(e,0,5,10)}}_scrollToToken(e){if(!this.expandedContentDom){return}const t=e.getBoundingClientRect();const o=this.expandedContentDom.getBoundingClientRect();if(t.left<o.left){this._scrollEnablement.scrollTo(this.expandedContentDom.scrollLeft-(o.left-t.left+5),0)}else if(t.right>o.right){this._scrollEnablement.scrollTo(this.expandedContentDom.scrollLeft+(t.right-o.right+5),0)}}async closeMorePopover(){(await this.getPopover()).close(false,false,true)}get _nMoreText(){if(this._getVisibleTokens().length){return I.i18nBundle.getText(S.MULTIINPUT_SHOW_MORE_TOKENS,this._nMoreCount)}return I.i18nBundle.getText(S.TOKENIZER_SHOW_ALL_ITEMS,this._nMoreCount)}get showNMore(){return!this.expanded&&this.showMore&&!!this.overflownTokens.length}get contentDom(){return this.shadowRoot.querySelector(".ui5-tokenizer--content")}get expandedContentDom(){return this.shadowRoot.querySelector(".ui5-tokenizer-expanded--content")}get narrowContentDom(){return this.shadowRoot.querySelector(".ui5-tokenizer-nmore--content")}get tokenizerLabel(){return I.i18nBundle.getText(S.TOKENIZER_ARIA_LABEL)}get morePopoverTitle(){return I.i18nBundle.getText(S.TOKENIZER_POPOVER_REMOVE)}get overflownTokens(){if(!this.contentDom){return[]}this._getTokens().forEach(e=>{e.overflows=false});return this._getTokens().filter(e=>{const t=this.contentDom.getBoundingClientRect();const o=e.getBoundingClientRect();const n=Number(o.right.toFixed(2));const i=Number(t.right.toFixed(2));const s=Number(o.left.toFixed(2));const r=Number(t.left.toFixed(2));e.overflows=!this.expanded&&(s<r||n>i);return e.overflows})}get hasValueState(){return this.valueState===p.default.None||this.valueState===p.default.Success}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get _valueStateMessageIcon(){const e={Error:"error",Warning:"alert",Success:"sys-enter-2",Information:"information"};return this.valueState!==p.default.None?e[this.valueState]:""}get _isPhone(){return(0,f.isPhone)()}get _selectedTokens(){return this._getTokens().filter(e=>e.selected)}get classes(){return{wrapper:{"ui5-tokenizer-root":true,"ui5-tokenizer-nmore--wrapper":this.showMore,"ui5-tokenizer-no-padding":!this._getTokens().length},content:{"ui5-tokenizer--content":true,"ui5-tokenizer-expanded--content":!this.showNMore,"ui5-tokenizer-nmore--content":this.showNMore},popoverValueState:{"ui5-valuestatemessage-root":true,"ui5-responsive-popover-header":true,"ui5-valuestatemessage--success":this.valueState===p.default.Success,"ui5-valuestatemessage--error":this.valueState===p.default.Error,"ui5-valuestatemessage--warning":this.valueState===p.default.Warning,"ui5-valuestatemessage--information":this.valueState===p.default.Information}}}get styles(){return{popover:{"min-width":this.popoverMinWidth?`${this.popoverMinWidth}px`:""},popoverValueStateMessage:{width:this.popoverMinWidth&&!(0,f.isPhone)()?`${this.popoverMinWidth}px`:"100%","min-height":"2rem"},popoverHeader:{"min-height":"2rem"},popoverHeaderTitle:{"justify-content":"left"}}}_tokensCountText(){const e=this._getTokens().length;if(e===0){return I.i18nBundle.getText(S.TOKENIZER_ARIA_CONTAIN_TOKEN)}if(e===1){return I.i18nBundle.getText(S.TOKENIZER_ARIA_CONTAIN_ONE_TOKEN)}return I.i18nBundle.getText(S.TOKENIZER_ARIA_CONTAIN_SEVERAL_TOKENS,e)}_focusLastToken(){if(this.tokens.length===0){return}const e=this.tokens[this.tokens.length-1];e.focus();this._itemNav.setCurrentItem(e)}static async onDefine(){I.i18nBundle=await(0,u.getI18nBundle)("@ui5/webcomponents")}async getPopover(){const e=await this.getStaticAreaItemDomRef();return e.querySelector("[ui5-responsive-popover]")}};N([(0,o.default)({type:Boolean})],O.prototype,"showMore",void 0);N([(0,o.default)({type:Boolean})],O.prototype,"disabled",void 0);N([(0,o.default)({type:Boolean})],O.prototype,"preventPopoverOpen",void 0);N([(0,o.default)({type:Boolean})],O.prototype,"expanded",void 0);N([(0,o.default)({type:Object})],O.prototype,"morePopoverOpener",void 0);N([(0,o.default)({validator:h.default})],O.prototype,"popoverMinWidth",void 0);N([(0,o.default)({type:p.default,defaultValue:p.default.None})],O.prototype,"valueState",void 0);N([(0,o.default)({validator:h.default})],O.prototype,"_nMoreCount",void 0);N([(0,o.default)({validator:h.default})],O.prototype,"_tokensCount",void 0);N([(0,n.default)({type:HTMLElement,default:true,individualSlots:true})],O.prototype,"tokens",void 0);N([(0,n.default)()],O.prototype,"valueStateMessage",void 0);O=I=N([(0,s.default)({tag:"ui5-tokenizer",languageAware:true,renderer:r.default,template:k.default,styles:E.default,staticAreaStyles:[w.default,y.default,x.default,C.default],staticAreaTemplate:b.default,dependencies:[g.default,m.default,T.default,_.default,v.default]}),(0,i.default)("token-delete",{detail:{ref:{type:HTMLElement}}}),(0,i.default)("show-more-items-press",{detail:{ref:{type:HTMLElement}}}),(0,i.default)("before-more-popover-open",{detail:{}})],O);O.define();var R=O;e.default=R});
//# sourceMappingURL=Tokenizer.js.map