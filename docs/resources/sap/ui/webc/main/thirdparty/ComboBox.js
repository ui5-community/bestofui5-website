sap.ui.define(["exports","sap/ui/webc/common/thirdparty/base/UI5Element","sap/ui/webc/common/thirdparty/base/decorators/customElement","sap/ui/webc/common/thirdparty/base/decorators/property","sap/ui/webc/common/thirdparty/base/decorators/event","sap/ui/webc/common/thirdparty/base/decorators/slot","sap/ui/webc/common/thirdparty/base/renderer/LitRenderer","sap/ui/webc/common/thirdparty/base/types/ValueState","sap/ui/webc/common/thirdparty/base/Device","sap/ui/webc/common/thirdparty/base/types/Integer","sap/ui/webc/common/thirdparty/base/types/InvisibleMessageMode","sap/ui/webc/common/thirdparty/base/util/AriaLabelHelper","sap/ui/webc/common/thirdparty/base/util/InvisibleMessage","sap/ui/webc/common/thirdparty/base/CustomElementsScope","sap/ui/webc/common/thirdparty/icons/slim-arrow-down","sap/ui/webc/common/thirdparty/icons/decline","sap/ui/webc/common/thirdparty/icons/not-editable","sap/ui/webc/common/thirdparty/icons/error","sap/ui/webc/common/thirdparty/icons/alert","sap/ui/webc/common/thirdparty/icons/sys-enter-2","sap/ui/webc/common/thirdparty/icons/information","sap/ui/webc/common/thirdparty/base/i18nBundle","sap/ui/webc/common/thirdparty/base/FeaturesRegistry","sap/ui/webc/common/thirdparty/base/Keys","./Filters","./generated/i18n/i18n-defaults","./generated/templates/ComboBoxTemplate.lit","./generated/templates/ComboBoxPopoverTemplate.lit","./generated/themes/ComboBox.css","./generated/themes/ComboBoxPopover.css","./generated/themes/ResponsivePopoverCommon.css","./generated/themes/ValueStateMessage.css","./generated/themes/Suggestions.css","./ComboBoxItem","./Icon","./Popover","./ResponsivePopover","./List","./BusyIndicator","./Button","./StandardListItem","./ComboBoxGroupItem","./GroupHeaderListItem","./types/ComboBoxFilter","./types/PopoverHorizontalAlign"],function(e,t,s,i,a,o,r,n,l,u,h,d,c,p,f,m,_,g,v,S,y,I,P,T,b,w,V,x,E,F,R,A,B,M,N,C,O,L,D,W,k,U,G,H,$){"use strict";Object.defineProperty(e,"__esModule",{value:true});e.default=void 0;t=q(t);s=q(s);i=q(i);a=q(a);o=q(o);r=q(r);n=q(n);u=q(u);h=q(h);c=q(c);b=K(b);V=q(V);x=q(x);E=q(E);F=q(F);R=q(R);A=q(A);B=q(B);M=q(M);N=q(N);C=q(C);O=q(O);L=q(L);D=q(D);W=q(W);k=q(k);U=q(U);G=q(G);H=q(H);$=q($);function j(e){if(typeof WeakMap!=="function")return null;var t=new WeakMap;var s=new WeakMap;return(j=function(e){return e?s:t})(e)}function K(e,t){if(!t&&e&&e.__esModule){return e}if(e===null||typeof e!=="object"&&typeof e!=="function"){return{default:e}}var s=j(t);if(s&&s.has(e)){return s.get(e)}var i={};var a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){if(o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)){var r=a?Object.getOwnPropertyDescriptor(e,o):null;if(r&&(r.get||r.set)){Object.defineProperty(i,o,r)}else{i[o]=e[o]}}}i.default=e;if(s){s.set(e,i)}return i}function q(e){return e&&e.__esModule?e:{default:e}}var Y=void 0&&(void 0).__decorate||function(e,t,s,i){var a=arguments.length,o=a<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i,r;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(e,t,s,i);else for(var n=e.length-1;n>=0;n--)if(r=e[n])o=(a<3?r(o):a>3?r(t,s,o):r(t,s))||o;return a>3&&o&&Object.defineProperty(t,s,o),o};var z;const J=10;var Q;(function(e){e["Error"]="error";e["Warning"]="alert";e["Success"]="sys-enter-2";e["Information"]="information"})(Q||(Q={}));let X=z=class e extends t.default{constructor(){super();this._filteredItems=[];this._initialRendering=true;this._itemFocused=false;this._autocomplete=false;this._isKeyNavigation=false;this._lastValue="";this._selectionPerformed=false;this._selectedItemText="";this._userTypedValue=""}onBeforeRendering(){const e=this.valueStatePopover;this.FormSupport=(0,P.getFeature)("FormSupport");if(this._initialRendering||this.filter==="None"){this._filteredItems=this.items}if(!this._initialRendering&&document.activeElement===this&&!this._filteredItems.length){e?.close()}this._selectMatchingItem();this._initialRendering=false;const t=this.icon.length||0;const s=this.readonly?0:1;this.style.setProperty((0,p.getScopedVarName)("--_ui5-input-icons-count"),`${t+s}`)}async onAfterRendering(){const e=await this._getPicker();if((0,l.isPhone)()&&e.opened){this.inner.focus()}if(await this.shouldClosePopover()&&!(0,l.isPhone)()){e.close(false,false,true);this._clearFocus();this._itemFocused=false}this.toggleValueStatePopover(this.shouldOpenValueStateMessagePopover);this.storeResponsivePopoverWidth();if((0,l.isSafari)()&&this._autocomplete&&this.filterValue!==this.value){this.inner.setSelectionRange(this._isKeyNavigation?0:this.filterValue.length,this.value.length)}}async shouldClosePopover(){const e=await this._getPicker();return e.opened&&!this.focused&&!this._itemFocused&&!this._isValueStateFocused}_focusin(e){this.focused=true;this._lastValue=this.value;this._autocomplete=false;!(0,l.isPhone)()&&e.target.setSelectionRange(0,this.value.length)}_focusout(e){const t=e.relatedTarget;const s=t?.shadowRoot?.querySelector(".ui5-valuestatemessage-root");this._fireChangeEvent();if(s){e.stopImmediatePropagation();return}if(!this.shadowRoot.contains(t)&&this.staticAreaItem!==e.relatedTarget){this.focused=false;!(0,l.isPhone)()&&this._closeRespPopover(e)}}_afterOpenPopover(){this._iconPressed=true}_afterClosePopover(){this._iconPressed=false;this._filteredItems=this.items;if((0,l.isPhone)()){this.blur()}if(this._selectionPerformed){this._lastValue=this.value;this._selectionPerformed=false}}async _toggleRespPopover(){const e=await this._getPicker();if(e.opened){this._closeRespPopover()}else{this._openRespPopover()}}async storeResponsivePopoverWidth(){if(this.open&&!this._listWidth){this._listWidth=(await this._getPicker()).offsetWidth}}toggleValueStatePopover(e){if(e){this.openValueStatePopover()}else{this.closeValueStatePopover()}}async openValueStatePopover(){(await this._getValueStatePopover())?.showAt(this)}async closeValueStatePopover(){(await this._getValueStatePopover())?.close()}async _getValueStatePopover(){const e=await this.getStaticAreaItemDomRef();const t=e.querySelector(".ui5-valuestatemessage-popover");this.valueStatePopover=t;return t}_resetFilter(){this._userTypedValue="";this.inner.setSelectionRange(0,this.value.length);this._filteredItems=this._filterItems("");this._selectMatchingItem()}_arrowClick(){this.inner.focus();this._resetFilter();if((0,l.isPhone)()&&this.value&&!this._lastValue){this._lastValue=this.value}this._toggleRespPopover()}_input(e){const{value:t}=e.target;const s=this.shouldAutocomplete(e);if(e.target===this.inner){e.stopImmediatePropagation();this.focused=true;this._isValueStateFocused=false}this._filteredItems=this._filterItems(t);this.value=t;this.filterValue=t;this._clearFocus();if(s&&!(0,l.isAndroid)()){const e=this._getFirstMatchingItem(t);e&&this._applyAtomicValueAndSelection(e,t,true);if(t!==""&&e&&!e.selected&&!e.isGroupItem){this.fireEvent("selection-change",{item:e})}}this.fireEvent("input");if((0,l.isPhone)()){return}if(!this._filteredItems.length||t===""){this._closeRespPopover()}else{this._openRespPopover()}}shouldAutocomplete(e){const t=e.inputType;const s=["deleteWordBackward","deleteWordForward","deleteSoftLineBackward","deleteSoftLineForward","deleteEntireSoftLine","deleteHardLineBackward","deleteHardLineForward","deleteByDrag","deleteByCut","deleteContent","deleteContentBackward","deleteContentForward","historyUndo"];return!s.includes(t)}_startsWithMatchingItems(e){return b.StartsWith(e,this._filteredItems,"text")}_clearFocus(){this._filteredItems.map(e=>{e.focused=false;return e})}handleNavKeyPress(e){if(this.focused&&((0,T.isHome)(e)||(0,T.isEnd)(e))&&this.value){return}const t=this.open;const s=this._filteredItems.find(e=>t?e.focused:e.selected);const i=s?this._filteredItems.indexOf(s):-1;e.preventDefault();if(this.focused&&t&&((0,T.isUp)(e)||(0,T.isPageUp)(e)||(0,T.isPageDown)(e))){return}if(this._filteredItems.length-1===i&&(0,T.isDown)(e)){return}this._isKeyNavigation=true;if(e.key==="ArrowDown"||e.key==="ArrowUp"||e.key==="PageUp"||e.key==="PageDown"||e.key==="Home"||e.key==="End"){this[`_handle${e.key}`](e,i)}}_handleItemNavigation(e,t,s){const i=this.open;const a=this._filteredItems[t];const o=s?this._filteredItems[t+1]:this._filteredItems[t-1];const r=a&&a.isGroupItem;if(!i&&(r&&!o||!r&&!a)){return}this._clearFocus();if(i){this._itemFocused=true;this.value=r?"":a.text;this.focused=false;a.focused=true}else{this.focused=true;this.value=r?o.text:a.text;a.focused=false}this._isValueStateFocused=false;this._announceSelectedItem(t);if(r&&i){return}const n=this._getFirstMatchingItem(this.value);n&&this._applyAtomicValueAndSelection(n,this.open?this._userTypedValue:"",true);if(n&&!n.selected){this.fireEvent("selection-change",{item:n})}this.fireEvent("input");this._fireChangeEvent()}_handleArrowDown(e,t){const s=this.open;if(this.focused&&t===-1&&this.hasValueStateText&&s){this._isValueStateFocused=true;this.focused=false;return}t=!s&&this.hasValueState&&t===-1?0:t;this._handleItemNavigation(e,++t,true)}_handleArrowUp(e,t){const s=this.open;if(t===0&&!this.hasValueStateText){this._clearFocus();this.focused=true;this._itemFocused=false;return}if(t===0&&this.hasValueStateText&&s){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;this._filteredItems[0].selected=false;return}if(this._isValueStateFocused){this.focused=true;this._isValueStateFocused=false;return}t=!s&&this.hasValueState&&t===-1?0:t;this._handleItemNavigation(e,--t,false)}_handlePageUp(e,t){const s=t-J>-1;t=s?t-J:0;const i=this._filteredItems[t].isGroupItem&&!this.open;if(!s&&this.hasValueStateText&&this.open){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;return}this._handleItemNavigation(e,t,i)}_handlePageDown(e,t){const s=this._filteredItems.length;const i=t+J<s;t=i?t+J:s-1;const a=this._filteredItems[t].isGroupItem&&!this.open;this._handleItemNavigation(e,t,a)}_handleHome(e){const t=this._filteredItems[0].isGroupItem&&!this.open;if(this.hasValueStateText&&this.open){this._clearFocus();this._itemFocused=false;this._isValueStateFocused=true;return}this._handleItemNavigation(e,0,t)}_handleEnd(e){this._handleItemNavigation(e,this._filteredItems.length-1,true)}_keyup(){this._userTypedValue=this.value.substring(0,this.inner.selectionStart||0)}_keydown(e){const t=(0,T.isDown)(e)||(0,T.isUp)(e)||(0,T.isPageUp)(e)||(0,T.isPageDown)(e)||(0,T.isHome)(e)||(0,T.isEnd)(e);const s=this.responsivePopover;this._autocomplete=!((0,T.isBackSpace)(e)||(0,T.isDelete)(e));this._isKeyNavigation=false;if(t&&!this.readonly&&this._filteredItems.length){this.handleNavKeyPress(e)}if((0,T.isEnter)(e)){this._fireChangeEvent();if(s?.opened){this._closeRespPopover();this.focused=true}else if(this.FormSupport){this.FormSupport.triggerFormSubmit(this)}}if((0,T.isEscape)(e)){this.focused=true;this.value=!this.open?this._lastValue:this.value;this._isValueStateFocused=false}if(((0,T.isTabNext)(e)||(0,T.isTabPrevious)(e))&&this.open){this._closeRespPopover()}if((0,T.isShow)(e)&&!this.readonly&&!this.disabled){e.preventDefault();this._resetFilter();this._toggleRespPopover();const t=this._filteredItems.find(e=>e.selected);if(t&&this.open){this._itemFocused=true;t.focused=true;this.focused=false}else if(this.open&&this._filteredItems.length){this._handleItemNavigation(e,0,true)}else{this.focused=true}}}_click(){if((0,l.isPhone)()&&!this.readonly){this._openRespPopover()}}_closeRespPopover(e){const t=this.responsivePopover;if(e&&e.target.classList.contains("ui5-responsive-popover-close-btn")&&this._selectedItemText){this.value=this._selectedItemText;this.filterValue=this._selectedItemText}if(e&&e.target.classList.contains("ui5-responsive-popover-close-btn")){this.value=this._lastValue||"";this.filterValue=this._lastValue||""}if((0,l.isPhone)()){this._fireChangeEvent()}this._isValueStateFocused=false;this._clearFocus();t?.close()}async _openRespPopover(){(await this._getPicker()).showAt(this)}_filterItems(e){const t=this.items.filter(e=>!e.isGroupItem);const s=(b[this.filter]||b.StartsWithPerTerm)(e,t,"text");return this.items.filter((e,t,i)=>z._groupItemFilter(e,++t,i,s)||s.indexOf(e)!==-1)}static _groupItemFilter(e,t,s,i){if(e.isGroupItem){let e;while(s[t]&&!s[t].isGroupItem&&!e){e=i.indexOf(s[t])!==-1;t++}return e}}_getFirstMatchingItem(e){const t=this.items.find(e=>e.focused===true);if(t?.isGroupItem){this.value=this.filterValue;return}const s=this._startsWithMatchingItems(e).filter(e=>!e.isGroupItem);if(s.length){return s[0]}}_applyAtomicValueAndSelection(e,t,s){const i=e&&e.text||"";this.inner.value=i;if(s){this.inner.setSelectionRange(t.length,i.length)}this.value=i}_selectMatchingItem(){const e=this.items.find(e=>e.focused);const t=e&&e.isGroupItem;const s=this._filteredItems.find(e=>!e.isGroupItem&&e.text===this.value&&!t);this._filteredItems=this._filteredItems.map(e=>{e.selected=e===s;return e})}_fireChangeEvent(){if(this.value!==this._lastValue){this.fireEvent("change");this._lastValue=this.value}}_inputChange(e){e.preventDefault()}_itemMousedown(e){e.preventDefault()}_selectItem(e){const t=e.detail.item;this._selectedItemText=t.mappedItem.text;this._selectionPerformed=true;const s=this.value===this._selectedItemText;const i=this.value.toLowerCase()===this.filterValue.toLowerCase();if(s&&i){this._fireChangeEvent();return this._closeRespPopover()}this.value=this._selectedItemText;if(!t.mappedItem.selected){this.fireEvent("selection-change",{item:t.mappedItem})}this._filteredItems.map(e=>{e.selected=e===t.mappedItem&&!e.isGroupItem;return e});this._fireChangeEvent();this._closeRespPopover();this.inner.setSelectionRange(this.value.length,this.value.length)}_onItemFocus(){this._itemFocused=true}_announceSelectedItem(e){const t=this._filteredItems[e];const s=t.additionalText||"";const i=t?.isGroupItem;const a=z.i18nBundle.getText(w.LIST_ITEM_POSITION,e+1,this._filteredItems.length);const o=z.i18nBundle.getText(w.LIST_ITEM_GROUP_HEADER);if(i){(0,c.default)(`${o} ${t.text}`,h.default.Polite)}else{(0,c.default)(`${s} ${a}`.trim(),h.default.Polite)}}get _headerTitleText(){return z.i18nBundle.getText(w.INPUT_SUGGESTIONS_TITLE)}get _iconAccessibleNameText(){return z.i18nBundle.getText(w.SELECT_OPTIONS)}get inner(){return(0,l.isPhone)()?this.responsivePopover.querySelector(".ui5-input-inner-phone"):this.shadowRoot.querySelector("[inner-input]")}async _getPicker(){const e=await this.getStaticAreaItemDomRef();const t=e.querySelector("[ui5-responsive-popover]");this.responsivePopover=t;return t}get hasValueState(){return this.valueState!==n.default.None}get hasValueStateText(){return this.hasValueState&&this.valueState!==n.default.Success}get ariaValueStateHiddenText(){if(!this.hasValueState){return""}let e="";if(this.valueState!==n.default.None){e=this.valueStateTypeMappings[this.valueState]}if(this.shouldDisplayDefaultValueStateMessage){return`${e} ${this.valueStateDefaultText||""}`}return`${e}`.concat(" ",this.valueStateMessageText.map(e=>e.textContent).join(" "))}get valueStateDefaultText(){if(this.valueState===n.default.None){return}return this.valueStateTextMappings[this.valueState]}get valueStateMessageText(){return this.getSlottedNodes("valueStateMessage").map(e=>e.cloneNode(true))}get valueStateTextMappings(){return{[n.default.Success]:z.i18nBundle.getText(w.VALUE_STATE_SUCCESS),[n.default.Error]:z.i18nBundle.getText(w.VALUE_STATE_ERROR),[n.default.Warning]:z.i18nBundle.getText(w.VALUE_STATE_WARNING),[n.default.Information]:z.i18nBundle.getText(w.VALUE_STATE_INFORMATION)}}get valueStateTypeMappings(){return{[n.default.Success]:z.i18nBundle.getText(w.VALUE_STATE_TYPE_SUCCESS),[n.default.Information]:z.i18nBundle.getText(w.VALUE_STATE_TYPE_INFORMATION),[n.default.Error]:z.i18nBundle.getText(w.VALUE_STATE_TYPE_ERROR),[n.default.Warning]:z.i18nBundle.getText(w.VALUE_STATE_TYPE_WARNING)}}get shouldOpenValueStateMessagePopover(){return this.focused&&!this.readonly&&this.hasValueStateText&&!this._iconPressed&&!this.open&&!this._isPhone}get shouldDisplayDefaultValueStateMessage(){return!this.valueStateMessage.length&&this.hasValueStateText}get _valueStatePopoverHorizontalAlign(){return this.effectiveDir!=="rtl"?$.default.Left:$.default.Right}get _valueStateMessageIcon(){return this.valueState!==n.default.None?Q[this.valueState]:""}get open(){return this?.responsivePopover?.opened||false}get _isPhone(){return(0,l.isPhone)()}get itemTabIndex(){return undefined}get ariaLabelText(){return(0,d.getEffectiveAriaLabelText)(this)}static async onDefine(){z.i18nBundle=await(0,I.getI18nBundle)("@ui5/webcomponents")}get styles(){const e=parseInt(getComputedStyle(document.documentElement).fontSize);return{popoverHeader:{width:`${this.offsetWidth}px`},suggestionPopoverHeader:{display:this._listWidth===0?"none":"inline-block",width:`${this._listWidth||""}px`},suggestionsPopover:{"min-width":`${this.offsetWidth||0}px`,"max-width":this.offsetWidth/e>40?`${this.offsetWidth}px`:"40rem"}}}get classes(){return{popover:{"ui5-suggestions-popover":!this._isPhone,"ui5-suggestions-popover-with-value-state-header":!this._isPhone&&this.hasValueStateText},popoverValueState:{"ui5-valuestatemessage-header":true,"ui5-valuestatemessage-root":true,"ui5-valuestatemessage--success":this.valueState===n.default.Success,"ui5-valuestatemessage--error":this.valueState===n.default.Error,"ui5-valuestatemessage--warning":this.valueState===n.default.Warning,"ui5-valuestatemessage--information":this.valueState===n.default.Information}}}};Y([(0,i.default)()],X.prototype,"value",void 0);Y([(0,i.default)()],X.prototype,"filterValue",void 0);Y([(0,i.default)()],X.prototype,"placeholder",void 0);Y([(0,i.default)({type:Boolean})],X.prototype,"disabled",void 0);Y([(0,i.default)({type:n.default,defaultValue:n.default.None})],X.prototype,"valueState",void 0);Y([(0,i.default)({type:Boolean})],X.prototype,"readonly",void 0);Y([(0,i.default)({type:Boolean})],X.prototype,"required",void 0);Y([(0,i.default)({type:Boolean})],X.prototype,"loading",void 0);Y([(0,i.default)({type:H.default,defaultValue:H.default.StartsWithPerTerm})],X.prototype,"filter",void 0);Y([(0,i.default)({type:Boolean})],X.prototype,"focused",void 0);Y([(0,i.default)({type:Boolean})],X.prototype,"_isValueStateFocused",void 0);Y([(0,i.default)()],X.prototype,"accessibleName",void 0);Y([(0,i.default)()],X.prototype,"accessibleNameRef",void 0);Y([(0,i.default)({type:Boolean,noAttribute:true})],X.prototype,"_iconPressed",void 0);Y([(0,i.default)({type:Object,noAttribute:true,multiple:true})],X.prototype,"_filteredItems",void 0);Y([(0,i.default)({validator:u.default,noAttribute:true})],X.prototype,"_listWidth",void 0);Y([(0,o.default)({type:HTMLElement,default:true,invalidateOnChildChange:true})],X.prototype,"items",void 0);Y([(0,o.default)()],X.prototype,"valueStateMessage",void 0);Y([(0,o.default)()],X.prototype,"icon",void 0);X=z=Y([(0,s.default)({tag:"ui5-combobox",languageAware:true,renderer:r.default,styles:E.default,staticAreaStyles:[R.default,A.default,F.default,B.default],template:V.default,staticAreaTemplate:x.default,dependencies:[M.default,N.default,O.default,L.default,D.default,W.default,k.default,G.default,C.default,U.default]}),(0,a.default)("change"),(0,a.default)("input"),(0,a.default)("selection-change",{detail:{item:{type:HTMLElement}}})],X);X.define();var Z=X;e.default=Z});
//# sourceMappingURL=ComboBox.js.map