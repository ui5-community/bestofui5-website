/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/base/Object","sap/ui/core/Core","sap/ui/core/CustomData","sap/ui/base/ManagedObjectObserver","./AnchorBar","sap/m/Button","sap/m/MenuButton","sap/m/Menu","sap/m/MenuItem","sap/ui/core/IconPool","sap/ui/core/InvisibleText"],function(jQuery,t,e,n,o,a,r,i,s,u,c,g){"use strict";var h=t.extend("sap.uxap._helpers.AB",{constructor:function(t){this._oObjectPageLayout=t;this._oObserver=new o(this._proxyStateChanges.bind(this));this._aMenusWithAttachPressHandler=[]},getInterface:function(){return this}});h._focusSection=function(t,e){var n=t.getDomRef();if(n){n.focus(e)}};h.prototype.getObjectPageLayout=function(){return this._oObjectPageLayout};h.prototype._proxyStateChanges=function(t){var e=t.object,n=this._findExistingClone(e),o=t.name,a=t.current,r="set"+l(o);if(n){n[r].call(n,a)}};h.prototype._findExistingClone=function(t){var e,n=t.getId()+"-__clone",o=this._getAnchorBar(),a=o.getContent();a.some(function(t){if(t.getId().indexOf(n)===0){e=t;return true}});return e};h.prototype._getAnchorBar=function(){var t=this.getObjectPageLayout(),e=t.getAggregation("_anchorBar");if(!e){e=new a({id:t.getId()+"-anchBar",showPopover:t.getShowAnchorBarPopover(),backgroundDesign:t.getBackgroundDesignAnchorBar()});e.attachEvent("_anchorPress",t.onAnchorBarTabPress,t);this.getObjectPageLayout().setAggregation("_anchorBar",e,true)}return e};h.prototype._setCustomData=function(t,e,o,a){o._oSectionInfo[e.getId()].buttonId=t.getId();t.addCustomData(new n({key:"sectionId",value:e.getId()}));t.addCustomData(new n({key:"bTitleVisible",value:e._getInternalTitleVisible()}));if(!a){t.addCustomData(new n({key:"secondLevel",value:true}))}};h.prototype._buildAnchorBar=function(){var t=this.getObjectPageLayout(),e=t.getSections()||[],o=this._getAnchorBar(),a=jQuery.proxy(o.onButtonPress,o),r,c,h,l,f=g.getStaticId("sap.m","SPLIT_BUTTON_DESCRIPTION");if(o&&this.getObjectPageLayout().getShowAnchorBar()){o._resetControl();this._oObserver.disconnect();e.forEach(function(e){if(!e.getVisible()||!e._getInternalVisible()){return}var g,d=e.getSubSections()||[];g=this._buildAnchorBarButton(e,true);if(g){o.addContent(g);if(g instanceof i){var _=new s({});g.enhanceAccessibilityState=function(t,e){var n=o.getContent(),a=n.indexOf(t.getParent());if(a!==-1){e.role="tab";e.setsize=n.length;e.posinset=a+1;e.labelledby=e.labelledby.split(" ").filter(function(t){return t!==f}).join(" ")}};_._setCustomEnhanceAccStateFunction(function(t,e){e.controls=t.data("sectionId")});g.setMenu(_)}d.forEach(function(e){if(!e.getVisible()||!e._getInternalVisible()){return}var s=this._buildAnchorBarButton(e,false),f=o.getId()+"-"+e.getId()+"-anchor";if(s){o.addContent(s)}if(g instanceof i){l=e.getCustomAnchorBarButton();if(l){r=l.getText();c=l.getIcon()}else{r=e._getInternalTitle()||e.getTitle();c=""}h=new u(f,{text:r,icon:c});h.addCustomData(new n({key:"sectionId",value:e.getId()}));h.attachPress(a);this._setCustomData(h,e,t,false);g.getMenu().addItem(h)}},this)}},this)}};h.prototype._moveFocusOnSection=function(t){var e=t.data(),n=sap.ui.getCore().byId(e.sectionId),o={preventScroll:true},a;if(n){if(n.isActive()){h._focusSection(n,o)}else{a={onAfterRendering:function(){n.removeEventDelegate(a);h._focusSection(n,o)}};n.addEventDelegate(a)}}};h.prototype._instantiateAnchorBarButton=function(t,e,n){var o,a;if(t){o=i;a={type:"Transparent",buttonMode:"Split",useDefaultActionOnly:true,ariaDescribedBy:e}}else{o=r;a={ariaDescribedBy:e}}if(n){a.id=n}return new o(a)};h.prototype._buildAnchorBarButton=function(t,e){var o=null,a=this.getObjectPageLayout(),r,i=this._getAnchorBar(),s,u,c,g,h=t.getAggregation("subSections"),l=jQuery.proxy(i.onButtonPress,i);if(t.getVisible()&&t._getInternalVisible()){r=t.getCustomAnchorBarButton();if(!r){s=i.getId()+"-"+t.getId()+"-anchor";if(e){if(h&&h.length>1){g=h.filter(function(t){return t.getVisible()&&t._getInternalVisible()}).length}}c=e&&g>1&&i.getShowPopover();if(c){o=this._instantiateAnchorBarButton(true,t,s);o.attachDefaultAction(l);o._getButtonControl().attachPress(function(){this.getParent().focus()});o._getButtonControl().attachArrowPress(function(){var t=o._getButtonControl();if(this._aMenusWithAttachPressHandler[t.getId()]){return}o.getMenu().attachItemSelected(function(t){this._moveFocusOnSection(t.getParameter("item"))},this);this._aMenusWithAttachPressHandler[t.getId()]=true},this);o.addCustomData(new n({key:"bHasSubMenu",value:true}))}else if(e){o=this._instantiateAnchorBarButton(false,t,s);o.attachPress(function(t){this._moveFocusOnSection(t.getSource())},this);o.attachPress(l)}else{u=i.getId()+"-"+t.getId()+"-sub-anchor";o=this._instantiateAnchorBarButton(false,t,u)}var f=t._getInternalTitle()!=""?t._getInternalTitle():t.getTitle();o.setText(f)}else{o=r.clone();o.attachPress(function(t){this._moveFocusOnSection(t.getSource())},this);o.attachPress(l);this._oObserver.observe(r,{properties:true})}this._setCustomData(o,t,a,e)}return o};function l(t){return t.substring(0,1).toUpperCase()+t.substring(1)}return h});
//# sourceMappingURL=ObjectPageLayoutABHelper.js.map