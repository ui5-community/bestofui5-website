"use strict";sap.ui.define(["sap/ui/model/Filter","sap/ui/model/FilterOperator"],function(e,t){class s{constructor(e){this.view=e}liveSearch(e){const t=e.getParameter("value").trim();this.view.getModel("settings").setProperty("/search",t);this.applySearchFilter()}applySearchFilter(){let s=this.view.getModel("settings").getProperty("/search");const r=this.view.getModel("settings").getProperty("/tokens");if(!s){s=""}const n=this.view.byId("listAllPackages");const i=n.getBinding("items");const o=new e({path:"name",operator:t.Contains,value1:s});const a=new e({path:"description",operator:t.Contains,value1:s});const l=r.filter(function(e){return e.type==="tag"});const c=new e("tags",function(e){let t=(e,t)=>t.every(t=>e.includes(t.key)&&t.type==="tag");if(t(e,l)){return true}}.bind(this));const g=[];for(let s=0;s<r.length;s++){if(r[s].type==="type"){const n=new e({path:"type",operator:t.EQ,value1:r[s].key});g.push(n)}}const p=new e({filters:g,and:true});
// filter license on object
const h=[];for(let s=0;s<r.length;s++){if(r[s].type==="license"){const n=new e({path:"licenseSource",operator:t.EQ,value1:r[s].key});h.push(n)}}const y=new e({filters:h,and:true});const u=[];if(l.length>0){u.push(c)}if(p.aFilters&&p.aFilters.length>0){u.push(p)}if(y.aFilters&&y.aFilters.length>0){u.push(y)}const f=new e({filters:u,and:true});const d=new e({filters:[o,a],and:false});if(r.length>0){i.filter(new e({filters:[d,f],and:true}))}else{i.filter(d)}this.setQueryParameters()}onSelectionChange(e){const t=this.view.getModel("settings");let s=t.getProperty("/tokens");const r=e.getParameter("selected");if(r){const t=e.getParameter("changedItem").getKey().split(";");const r={key:t[0],type:t[1]};s.push(r)}else{const t=e.getParameter("changedItem").getKey().split(";");const r={key:t[0],type:t[1]};s=s.filter(function(e){return!(e.key===r.key&&e.type===r.type)})}this.view.getModel("settings").setProperty("/tokens",s)}getParameterFromQuery(e){if("search"in e){this.view.getModel("settings").setProperty("/search",e.search)}if("tokens"in e){const t=e.tokens.split(",").map(function(e){const t=e.split(":");return{key:t[0],type:t[1]}});this.view.getModel("settings").setProperty("/tokens",t)}if("sort"in e){this.view.getModel("settings").setProperty("/selectKey",e.sort)}if("order"in e){const t=e.order==="asc"?false:true;this.view.getModel("settings").setProperty("/sortOrderDecending",t)}}setQueryParameters(){const e=this.view.getModel("settings").getProperty("/search");const t=this.view.getModel("settings").getProperty("/tokens");let s=this.view.getModel("settings").getProperty("/selectKey");let r=this.view.getModel("settings").getProperty("/sortOrderDecending");if(s==="downloads365"){s=""}const n=t.map(function(e){return`${e.key}:${e.type}`}).join(",");const i={search:e,tokens:n,sort:s,order:r?"":"asc"};Object.keys(i).forEach(function(e){if(!i[e]){delete i[e]}});let o="packages?";for(let e in i){if(i[e]!==undefined&&i[e]!==null&&i[e]!==""){if(e===Object.keys(i)[0]){o+=e+"="+i[e]}else{o+="&"+e+"="+i[e]}}}if(o!=="packages?"){this.view.getController().getRouter().getHashChanger().setHash(o)}else{this.view.getController().getRouter().getHashChanger().setHash("packages")}}}return s});
//# sourceMappingURL=QueryUtil.js.map